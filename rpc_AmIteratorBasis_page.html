<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: AmIteratorBasis</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="index.html">PSCF - Polymer Self-Consistent Field</a></li><li class="navelem"><a href="scft_page.html">Self-Consistent Field Theory</a></li><li class="navelem"><a href="scft_param_page.html">Parameter Files</a></li><li class="navelem"><a href="scft_param_pc_page.html">Parameter File - pscf_pc and pscf_pg</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">AmIteratorBasis </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The AmIteratorBasis algorithm used by either the pscf_pc program or pscf_pg solves the SCFT equations for a periodic system using the Anderson Mixing algorithm. Closely analogous classes to implement this algorithm are defined in the <a class="el" href="namespacePscf_1_1Rpc.html" title="Real periodic fields, SCFT and PS-FTS (CPU).">Pscf::Rpc</a> and <a class="el" href="namespacePscf_1_1Rpg.html" title="SCFT and PS-FTS with real periodic fields (GPU)">Pscf::Rpg</a> namespaces.</p>
<p>Class API documentation: </p><ul>
<li>
<a class="el" href="classPscf_1_1Rpc_1_1AmIteratorBasis.html" title="Anderson Mixing iterator with imposed space-group symmetry.">Pscf::Rpc::AmIteratorBasis</a>  </li>
<li>
<a class="el" href="classPscf_1_1Rpg_1_1AmIteratorBasis.html" title="Anderson Mixing iterator with imposed space-group symmetry.">Pscf::Rpg::AmIteratorBasis</a>  </li>
</ul>
<h1 class="doxsection"><a class="anchor" id="rpc_AmIteratorBasis_algorithm_sec"></a>
Algorithm</h1>
<p>The variant of Anderson mixing implemented by the AmIteratorBasis classes is very similar to that described in a paper by Arora et al. <br  />
 [Arora, Morse, Bates, and Dorfman, J. Chem. Phys. vol. 146, 244902 (2017)], which was written as a description of an algorithm used in the older Fortran version of PSCF. The version of this algorithm used by AmIteratorBasis adjusts the fields by adjusting the compoments of each field in a basis of symmetry adapated basis functions, thereby preserving the space-group symmetry of the fields throughout the iteration. The algorithm can be used to either solve the SCFT equations for a rigid unit cell or to solve the SCFT equations and also optimize some or all of the unit cell parameters of a flexible unit cell so as to minimize the free energy density. The treatment of unit cell parameters depends on the values of the "isFlexible" and "flexibleParams" parameters, as described below.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="pscf_AmIteratorTmpl_page.html">Anderson Mixing Solver Algorithms</a></dd></dl>
<h1 class="doxsection"><a class="anchor" id="rpc_AmIteratorBasis_parameter_sec"></a>
Parameter file</h1>
<p>A typical example of the parameter file format for this iterator is shown below: </p><div class="fragment"><div class="line">AmIteratorBasis{</div>
<div class="line">  epsilon      1e-8</div>
<div class="line">  maxItr       100</div>
<div class="line">  maxHist      50</div>
<div class="line">  isFlexible   1</div>
<div class="line">}</div>
</div><!-- fragment --><p> The format of this block is described more formally below: </p><div class="fragment"><div class="line">AmIteratorBasis{</div>
<div class="line">   epsilon          real </div>
<div class="line">   maxItr*          int (200 by <span class="keywordflow">default</span>)</div>
<div class="line">   maxHist*         int (50 by <span class="keywordflow">default</span>)</div>
<div class="line">   verbose*         int (0-2, 0 by <span class="keywordflow">default</span>)</div>
<div class="line">   errorType*       string (<span class="stringliteral">&quot;norm&quot;</span>, <span class="stringliteral">&quot;rms&quot;</span>, <span class="stringliteral">&quot;max&quot;</span>, or <span class="stringliteral">&quot;relNorm&quot;</span>, <span class="stringliteral">&quot;relNorm&quot;</span> by <span class="keywordflow">default</span>)</div>
<div class="line">   isFlexible*      bool (0 or 1, 1/<span class="keyword">true</span> by <span class="keywordflow">default</span>)</div>
<div class="line">   flexibleParams*  Array [ bool ] (nParameters elements)</div>
<div class="line">   scaleStress*     real (10.0 by <span class="keywordflow">default</span>)</div>
<div class="line">   lambda*          real (1.0 by <span class="keywordflow">default</span>)</div>
<div class="line">   useLambdaRamp    bool (<span class="keyword">true</span> by <span class="keywordflow">default</span>)</div>
<div class="line">   r                real (0.9 by <span class="keywordflow">default</span>)</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p> Here, as elsewhere, labels followed by an asterisk (*) represent optional parameters. The meaning of the various parameters are described below: </p><table class="doxtable">
<tr>
<td><b> Label </b> </td><td><b> Description </b> </td></tr>
<tr>
<td>epsilon </td><td>Error tolerance - iteration stops if the magnitude of the error becomes less than epsilon. </td></tr>
<tr>
<td>maxItr* </td><td>Maximum number of iterations that will be attempted before terminating (200 by default) </td></tr>
<tr>
<td>maxHist* </td><td>Maximum number of previous trial solulions that will be retained in memory for used by the AM algorithm (50 by default) </td></tr>
<tr>
<td>verbose* </td><td>Integer level 0, 1, 2 for verbosity of log output during iteration. (0 by default) </td></tr>
<tr>
<td>errorType* </td><td>Identifer for the choice of a definition for the scalar error . Meaning of the allowed values are "norm", "rms" "max", and "relNorm", are discussed <a class="el" href="pscf_AmIteratorTmpl_page.html">here</a>. ("relNorm" by default) </td></tr>
<tr>
<td>isFlexible* </td><td>Set isFlexible true to enable or false to disable iterative optimization of unit cell parameters so as to minimize the free energy density. (true by default) </td></tr>
<tr>
<td>flexibleParams* </td><td>Use flexibleParams to declare only <em>some</em> lattice parameters as flexible. <b>This optional entry is allowed only if the isFlexible parameter is true.</b> This array must contain one entry for each lattice parameter, with a value 1 (true) if the parameter is flexible or 0 (false) if the parameter value is fixed. If isFlexible is true but flexibleParams is absent, then all lattice parameters will be flexible. </td></tr>
<tr>
<td>scaleStress* </td><td>Constant factor by which stress components are multiplied in the definition of the residual attempted if isFlexible is true (10.0 by default). </td></tr>
<tr>
<td>lambda* </td><td>Mixing parameter in standard mixing correction step for an <a class="el" href="pscf_AmIteratorTmpl_page.html">Anderson mixing algorithm</a>. (1.0 by default) </td></tr>
<tr>
<td>useLambdaRamp* </td><td>If true, use ramp-up of mixing parameter, as discussed <a class="el" href="pscf_AmIteratorTmpl_page.html#pscf_AmIteratorTmpl_algo_correct_sub">here</a>. (true by default) </td></tr>
<tr>
<td>r* </td><td>Ratio used in formula for slow ramp-up of mixing parameter, as discussed <a class="el" href="pscf_AmIteratorTmpl_page.html#pscf_AmIteratorTmpl_algo_correct_sub">here</a>. (0.9 by default) </td></tr>
</table>
<p>The iterative loop exits if the number of iterations has reached maxItr or if the magnitude of the scalar error drops below epsilon.</p>
<p><b> scaleStress </b>: If isFlexible is true, the choice of a value for the parameter scaleStress determines how strongly the definition of the scalar error weights errors that arise from nonzero derivatives of the free energy with respect to the unit cell parameters, relative to errors arising from errors in the SCFT equations for the w fields in a fixed unit cell. This variable is irrelevant if isFlexible is false, and should normally be ommitted in this case.</p>
<h1 class="doxsection"><a class="anchor" id="rpc_AmIteratorBasis_residual_sec"></a>
Residual definition</h1>
<p>The vector of residuals used in this algorithm is described by Eqs. (10-13) of the article by Arora et al. (J. Chem. Phys. 2017). To describe the residuals here, we use zero based indexing for monomer types and basis functions, us use \( N_{b} \) to denote the number of basis functions (referred to in the source code as Nbasis), and use \( N_{m} \) to denote the number of monomer types (referred to elsewhere as nMonomer).</p>
<p>The vector of residuals for a calculation for a rigid unit cell (i.e., one with isFlexible set false) has \( N_{b}N_{m} \) (or nBasis*nMonomer) scalar residuals. <br  />
 Let \( w_{ia} \) and \( \phi_{ai} \) denote the coefficients of basis function a in the symmetry-adapted Fourier expansions of the chemical potential field \( w_{i} \) and volume fraction \( \phi_{i} \) for monomer type i, respectively. The residual component \( R_{ai}\) associated with basis function a and monomer type i is given, as in Eq. (10) of Arora et al. (JCP 2017), as     </p><p class="formulaDsp">
\[  R_{ai} = \sum_{j=0}^{N_{m}-1} 
           \left ( \chi_{ij} \phi_{aj} - P_{ij}w_{aj} \right ) 
  \quad.
\]
</p>
<p> Here, \( P_{ij} \) is an element of an idempotent \( N_{m} \times N_{m} \) matrix \(  P \) that can be expressed in matrix notation as      </p><p class="formulaDsp">
\[  P  = I
  - \frac{\epsilon \epsilon^{T} \chi^{-1} }
        { \epsilon^{T} \chi^{-1} \epsilon }
 \quad.
\]
</p>
<p> where \( \chi^{-1} \) is the matrix inverse of the \(\chi\) matrix, and \(\epsilon\) is a \( N_{m} \)-component column vector with elements given by \( \epsilon_{i} = 1 \) for all \( i = 0, \ldots, N_{m}-1 \).</p>
<p>The vector of residuals for a calculation with a flexible unit cell (with isFleixble set true) has an additional stress residual associated with each flexible unit cell parameter. The residual \( R_{m} \) associated with flexible unit cell parameter \( \theta_{m} \) is given by   </p><p class="formulaDsp">
\[    R_{m} = -S\frac{\partial f}{\partial \theta_{m}}
\]
</p>
<p> where \( f \) is the free energy per monomer (i.e., the free energy density times the monomer reference volume) in units in which \( kT = 1 \), while \(S\) is an arbitrary prefactor whose value is given by the parameter scaleStress. (The factor \(S\) is set to 10.0 by default).</p>
<h1 class="doxsection"><a class="anchor" id="rpc_AmIteratorBasis_closed_sec"></a>
Closed systems (canonical ensemble)</h1>
<p>A slight modification of the residual definition is required in the case case when a value of phi rather than mu is specified for every molecular species, giving a closed system, or a canonical statistical ensemble. In this case, the solution of the SCF problem is not unique, becase the values of the residuals defined above can be shown to be invariant under a shift in all of the chemical potential fields at all grid point points by any spatially homgeneous constant. To obtain a unique solution, in this case the spatial average of the Laplace multiplier field \( \xi({\bf r}) \) is implicitly set to zero by convention. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on <span class="timestamp"></span> for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
