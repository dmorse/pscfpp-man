<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: Basics: Adding a New Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="index.html">PSCF - Polymer Self-Consistent Field</a></li><li class="navelem"><a href="developer_page.html">Developer Information</a></li><li class="navelem"><a href="developer_build_page.html">Build System</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Basics: Adding a New Source File </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="developer_build_compile_page.html">Basics: Compiling</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="developer_build_make_page.html">Make and Makefiles</a> (Next) <br  />
</p>
<p>In order to add new features to PSCF, developers often need to add new compilable source files to the src directory. This page briefly explains how to add edit files used by the build system to tell the build system to compile any such new source files.</p>
<p>Almost every subdirectory of the src directory tree contain a file named "sources.mk". This file is a makefile fragment that is included into multiple makefiles. The purpose of each such file is to maintain a list of all of the *.cpp and *.cu files in that directory that should be compiled when PSCF is built. The most important part of this file is a statement near the top that assigns a makefile variable a value that contains a list of source files in the relevant directory. To tell the build system to compile a new source file, this file simply needs to be added to this list in the sources.mk file within the directory that contains the new source file.</p>
<p>For example, consider the sources.mk file in the directory src/r1d/iterator. This directory contains source code files for several classes that implement different SCFT iteration algorithms that can used by the pscf_1d program, and a few related classses. The relevant part of in this directory, which appears at the top of the file, is a makefile statement that looks like this: </p><div class="fragment"><div class="line">r1d_iterator_=\</div>
<div class="line">  r1d/iterator/Iterator.cpp \</div>
<div class="line">  r1d/iterator/IteratorFactory.cpp \</div>
<div class="line">  r1d/iterator/NrIterator.cpp \</div>
<div class="line">  r1d/iterator/BinaryRelaxIterator.cpp \</div>
<div class="line">  r1d/iterator/AmIterator.cpp</div>
</div><!-- fragment --><p> In this statement, the string r1d_iterator_ is the name of a makefile variable whose value is a space separated list of names of compilable source files in the relevant directory r1d/iterator. The name of the corresponding variable defined in the sources.mk in each subdirectory of the src directory is given by mangled form of the path to that subdirectory from the src directory, in which the slash characters that separate directory names in the actual directory path are replaced by understores, and an extra underscore is appended at the end. In this example, the path r1d/iterator of the relevant directory relative to the src directory is translated into a variable name r1d_iterator_. The value of this variable must be a space-separated list containing paths to all of the source files in this directory that should be compiled by the build system. The path for each file in this list must be given as its path relative to the src directory. This list given in this example is formatted with one file per line, but the backslash at the end of each line is a symbol used by the make command to indicate continuation of a line. The resulting string is thus equivalent to one we could also obtain by writing all of these paths on single line, separated by spaces.</p>
<p>Suppose that one had created a new SCFT iteration algorithm for use by this program that was implemented as a new class named NewIterator. Suppose that this class is defined by several files that are located in the rpc/iterator directory, including a new compilable source file named NewIterator.cpp To add a the new source file to the build system, one would simply add a backslash to the end of the last line of the existing definition of rpc_iterator_, and then add the path to the new source file as an additional line. The modified definition of r1d_iterator_ would like like this: </p><div class="fragment"><div class="line">r1d_iterator_=\</div>
<div class="line">  r1d/iterator/Iterator.cpp \</div>
<div class="line">  r1d/iterator/IteratorFactory.cpp \</div>
<div class="line">  r1d/iterator/NrIterator.cpp \</div>
<div class="line">  r1d/iterator/BinaryRelaxIterator.cpp \</div>
<div class="line">  r1d/iterator/AmIterator.cpp \</div>
<div class="line">  r1d/iterator/NewIterator.cpp</div>
</div><!-- fragment --><p> The path to each new file must be given as a path relative to the src directory, as for existing files.</p>
<p>The content of sources.mk files, including elements that are not shown here, is discussed in more detail on a <a class="el" href="developer_build_source_page.html">separate page</a>.</p>
<p><br  />
 <a class="el" href="developer_build_compile_page.html">Basics: Compiling</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="developer_build_page.html">Build System</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="developer_build_make_page.html">Make and Makefiles</a> (Next) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on <span class="timestamp"></span> for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
