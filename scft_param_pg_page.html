<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: Parameter File - pscf_pg</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="index.html">PSCF - Polymer Self-Consistent Field</a></li><li class="navelem"><a href="scft_page.html">Self-Consistent Field Theory</a></li><li class="navelem"><a href="scft_param_page.html">Parameter Files</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Parameter File - pscf_pg </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="scft_param_pc_page.html">Parameter File - pscf_pc</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="scft_field_page.html">Field Files</a> (Next) <br  />
</p>
<p>The parameter file format for SCFT calculations using the pscf_pg GPU-accelerated program is almost identical to the parameter file format for <a class="el" href="scft_param_pc_page.html">pscf_pc</a>. The Mixture block uses the same format as that used by both pscf_1d and pscf_pc, with the exception of a single optional added parameter (<span class="tt">useBatchedFFT</span>, outlined <a class="el" href="#scft_param_pg_batched_fft_sec">below</a>). The Interaction block also uses the same format as pscf_1d and pscf_pc, and the Domain and Environment blocks have the same format as that used by pscf_pc. The main differences between pscf_pc and pscf_pg parameter files are differences in the available iterators.</p>
<h1 class="doxsection"><a class="anchor" id="scft_param_pg_iterator_sec"></a>
Iterators</h1>
<p>The default iterator for pscf_pg, which is implemented by class Rpg::AmIteratorBasis&lt;D&gt;, uses an Anderson-Mixing (AM) algorithm that imposes a prescribed space group symmetry, much like the analogous <a class="el" href="rpc_AmIteratorBasis_page.html">Rpc::AmIteratorBasis</a> iterator used by pscf_pc. This iteration algorithm may be invoked in the parameter file for pscf_pg using either the generic block label "Iterator" or a specific label "AmIteratorBasis". The parameter file must contain a groupName parameter within the Domain block to enable use of this iterator. The implementation of AmIteratorBasis uses an expansion of the chemical potential fields and the residual as vectors with components that represent coefficients in symmetry-adapted Fourier expansions of the corresponding fields.</p>
<p>The only other iterator currently provided for use with pscf_pg is an Anderson mixing algorithm that does not impose any space group symmetry. This iterator is invoked using the label AmIteratorGrid in the parameter file, and may be used with a parameter file that does not contain a groupName parameter. In the implementation of AmIteratorGrid, the w fields and residual are represented internally as vectors whose elements represent values of fields on the nodes of a regular spatial grid, rather than coefficients in a symmetry-adapted Fourier expansion.</p>
<p>Descriptions of the parameter file formats for the available iterators can be found by following the links in the table below: </p><table class="doxtable">
<tr>
<td><b> Class </b> </td><td><b> Description </b> </td></tr>
<tr>
<td><a class="el" href="rpg_AmIteratorBasis_page.html">AmIteratorBasis</a> </td><td>Anderson Mixing iterator for periodic structures, formulated using a symmetry-adapted basis (default) </td></tr>
<tr>
<td><a class="el" href="rpg_AmIteratorGrid_page.html">AmIteratorGrid</a> </td><td>Anderson Mixing iterator for periodic structures, formulated using values defined on a spatial grid </td></tr>
</table>
<h1 class="doxsection"><a class="anchor" id="scft_param_pg_sweep_sec"></a>
Sweep</h1>
<p>The only sweep algorithm currently available for use with pscf_pg is a general linear sweep algorithm identical to that used by pscf_pc. This can be enabled by including a block that starts either with the generic label Sweep or the specific label LinearSweep. The required parameter file format for a linear sweep is described <a class="el" href="scft_param_sweep_page.html#scft_param_sweep_linear_sec">here</a>.</p>
<h1 class="doxsection"><a class="anchor" id="scft_param_pg_batched_fft_sec"></a>
useBatchedFFT</h1>
<p>To compute the stress values for a flexible unit cell, fast Fourier transforms (FFTs) need to be performed on the propagator at every step along the chain contour. This often means 100 or more independent FFTs at a time. By default, pscf_pg performs these FFTs in parallel, using a "batched" FFT algorithm provided by cuFFT that performs as many parallel FFTs as is needed to maximize GPU occupancy. This can greatly accelerate stress calculations when the grid size is modest.</p>
<p>However, batched FFTs require significant amounts of memory to be allocated on the GPU to store the Fourier transform of the propagator, which can be avoided when using non-batched FFTs. To be precise, batched FFTs nearly double the total on-chip memory usage of the whole program. We therefore provide an optional parameter, <span class="tt">useBatchedFFT</span>, which allows users to toggle between batched and non-batched FFTs. This parameter immediately follows <span class="tt">ds</span> in the Mixture block of the parameter file.</p>
<p>Whether or not batched FFTs will cause a problem depends on both the GPU being used and the number of gridpoints in the system. Modern GPUs tend to have very large on-chip memories (for example, an A100 has 40GB), so they are capable of handling the memory demand of batched FFTs in all but the very largest of calculations. Older GPUs, however, have smaller on-chip memories, meaning that users may encounter an "out of memory" error even when the calculation is not terribly large.</p>
<p>Furthermore, the computational benefit of batched FFTs shrinks as the number of gridpoints increases. For calculations with 100,000 gridpoints on an A40 GPU, we have found that batched FFTs allow the stress to be calculated 10x faster than non-batched FFTs, while for calculations with 1,000,000 gridpoints, batched FFTs are only 1.16x faster.</p>
<p>Therefore, we recommend that users use non-batched FFTs for calculations that exceed one million gridpoints, or for smaller calculations when paired with older GPUs. If an "out of memory" error is encountered when using batched FFTs, using non-batched FFTs instead will likely remediate the error.</p>
<h1 class="doxsection"><a class="anchor" id="scft_param_pg_seealso_sec"></a>
See Also:</h1>
<ul>
<li>
<a class="el" href="scft_param_pc_page.html">Parameter file for pscf_pc (SCFT)</a>  </li>
<li>
<a class="el" href="rpc_System_page.html">Rpc::System</a>  </li>
<li>
<a class="el" href="rpg_AmIteratorBasis_page.html">Rpg::AmIteratorBasis</a>  </li>
<li>
<a class="el" href="rpg_AmIteratorGrid_page.html">Rpg::AmIteratorGrid</a>  </li>
</ul>
<p><br  />
 <a class="el" href="scft_param_pc_page.html">Parameter File - pscf_pc</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="scft_param_page.html">Parameter Files</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="scft_field_page.html">Field Files</a> (Next) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on <span class="timestamp"></span> for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
