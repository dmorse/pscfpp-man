<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: Batched FFT usage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="index.html">PSCF - Polymer Self-Consistent Field</a></li><li class="navelem"><a href="user_page.html">User Introduction</a></li><li class="navelem"><a href="user_param_page.html">Parameter Files</a></li><li class="navelem"><a href="user_param_mixture_page.html">Parameter File - Mixture Block</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Batched FFT usage </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="user_param_mixture_page.html">Parameter File - Mixture Block</a> (Prev/Up) &#160; &#160; &#160; &#160; <a class="el" href="user_param_domain_page.html">Parameter File - Domain Block</a> (Next) <br  />
</p>
<p>The format of the Mixture block in parameter files used by pscf_pg differs from that of pscf_pc and pscf_1d in that the format for pscf_pg allows an additional optional boolean parameter named "useBatchedFFT". <br  />
 This extra parameter appears at the end of the Mixture block, immediately after <span class="tt">ds</span>, and is equal to 1 (or true) by default. The purpose of this parameter is explained below.</p>
<p>To compute the stress values for a flexible unit cell, fast Fourier transforms (FFTs) need to be performed on both the forward and backward propagator of every polymer block at every monomer or step along the block contour. This stress calculation is performed after solution of the modified diffusion equation for all blocks and directions, and often requires several hundred additional FFTs that are not needed for other purposes. By default, pscf_pg performs these FFTs in parallel using a "batched" FFT algorithm provided by cuFFT, which performs parallel FFTs in a manner that maximizes GPU occupancy. Use of this option can signficantly accelerate stress calculations when the grid size is modest.</p>
<p>However, batched FFTs require significant additional amounts of memory to be allocated on the GPU to store the Fourier transforms of multiple slices of each block, which can be avoided using non-batched FFTs. Because storage of propagators dominates overall memory usage, use of batched FFTs can almost double the total on-chip memory usage of the whole program. PSCF therefore provides an optional parameter, <span class="tt">useBatchedFFT</span>, that allows users to either enable use of batched FFTs to save computation time at a cost in memory usage (the default) or to disable batched FFTs to save memory. <br  />
</p>
<p>Whether or not batched FFTs will exhaust available global GPU memory depends on both the GPU being used and the number of gridpoints in the system. Modern GPUs have large on-chip memories that are capable of handling the memory demand of batched FFTs in all but the very largest of calculations. For example, an A100 has 40GB of global GPU memory. Older GPUs, however, have smaller on-chip memories, meaning that users could encounter an "out of memory" error even when the calculation is not terribly large.</p>
<p>The computational benefit of batched FFTs also shrinks as the number of gridpoints increases. For calculations with 100,000 gridpoints on an A40 GPU, we have found that batched FFTs allow the stress to be calculated 10x faster than non-batched FFTs, while for calculations with 1,000,000 gridpoints, batched FFTs are only 1.16x faster.</p>
<p>Therefore, we recommend that users use non-batched FFTs for calculations that use more than approximately one million gridpoints, or for smaller calculations on older GPUs. If an "out of memory" error is encountered when using batched FFTs, users should try using non-batched FFTs to see if the resulting reduction in memory usage is enough to solve the problem.</p>
<p><br  />
 <a class="el" href="user_param_mixture_page.html">Parameter File - Mixture Block</a> (Prev/Up) &#160; &#160; &#160; &#160; <a class="el" href="user_param_domain_page.html">Parameter File - Domain Block</a> (Next) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on <span class="timestamp"></span> for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
