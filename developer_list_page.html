<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: Source File Lists</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">PSCF - Polymer Self-Consistent Field Theory</a></li><li class="navelem"><a class="el" href="developer_page.html">Developer Information</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Source File Lists</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="developer_directory_page.html">Directory Structure</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="developer_build_page.html">Build System</a> (Next) <br  />
</p>
<p>To add files to PSCF to implement a new feature, a developer must usually add the name of associated source file with extension *.cpp or *.cu to a list of files that the build system should compile. This list is maintained in a file named "sources.mk" in the directory that contains the new source file.</p>
<h1><a class="anchor" id="developer_list_sources"></a>
Source and object file lists</h1>
<p>Almost every subdirectory of the src/ directory tree contain a file named "sources.mk". This file is a makefile fragment that is included into other makefile fragments and makefiles. Each such sources.mk file defines a makefile variable whose value is a list of the source files in that directory and all of its subdirectories that should be compiled when the PSCF is built.</p>
<p>The name of the makefile variable that contains this list of source files is always a string of the form [directory]_, where "[directory]" represents a mangled form of the name of the subdirectory containing the source.mk file. Specifically, the [directory] string in each such variable name is constructed by taking the relative path from the src/ directory to the subdirectory of interest and replacing each "/" directory separator in this path an underscore ("_"). As an example that is discussed in more detail below, the file src/pscf/chem/sources.mk defines a variable of this kind named pscf_chem_.</p>
<p>Every sources.mk file also defines a second makefile variable with a name of the form [directory]_OBJS that contains a corresponding list of paths to the *.o object files (extension *.o) that should be created by compiling the listed source files. For example, the file src/pscf/chem/sources.mk thus a defines a variable pscf_chem_OBJS.</p>
<p>In what follows, we refer to the [directory]_ variable in each such file as a source file list, and the [directory]_OBJS variable as an object file list. Paths to files in each source file list are always given as relative paths, defined relative to the PSCF src/ directory. File paths in the object file lists are instead always given as absolute paths to locations in which object files should be placed within the build directory. The object file list is created automatically by applying some simple text manipulation operations to the source file list, as shown in the examples discussed below.</p>
<h1><a class="anchor" id="make_example1"></a>
Example - a directory with no subdirectories</h1>
<p>The simplest type of sources.mk files occur in directories that do not contain any subdirectories. As an example of this case, the contents of the file src/pscf/chem/sources.mk is shown below: </p><div class="fragment"><div class="line">pscf_chem_= \</div>
<div class="line">  pscf/chem/Monomer.cpp \</div>
<div class="line">  pscf/chem/Vertex.cpp \</div>
<div class="line">  pscf/chem/BlockDescriptor.cpp \</div>
<div class="line">  pscf/chem/SolventDescriptor.cpp \</div>
<div class="line">  pscf/chem/PolymerType.cpp \</div>
<div class="line">  pscf/chem/Species.cpp </div>
<div class="line"> </div>
<div class="line">pscf_chem_OBJS=\</div>
<div class="line">     $(addprefix $(BLD_DIR)/, $(pscf_chem_:.cpp=.o))</div>
</div><!-- fragment --><p> The definition of pscf_chem_ in this example uses a makefile syntax syntax in which a backslash (\) character is used to continue a statement to the next line. Lines 2 - 7 of this example thus assign the variable pscf_chem a list of file names separated by spaces.</p>
<p>The value assigned pscf_chem_ in this example is a list of all of the C++ source files in the relevant subdirectory, src/pscf/chem. Note that all paths in this definition are given as relative paths, defined relative to the src/ directory. All of these files are C++ source files with names that end with file extension .cpp. CUDA C++ source files with file extension .cu can also be included in source file lists. Source file lists should not, however, contain any *.h header files or *.tpp template implementation files.</p>
<p>The value that is assigned to the object file list variable pscf_chem_OBJS is a corresponding list of paths to object files, with extension *.o. The value of this object file list variable is constructed in the last two lines of this example by applying two makefile text manipulation functions to the value of the source file list pscf_chem_. First, the ":" operator is used in the expression $(pscf_chem_:.cpp=.o) to replace the .cpp extension with .o in each of the file names in pscf_chem_. The "addprefix" function is the used to add the absolute path to the build directory as a common prefix. The result is a list of absolute paths to the locations of the *.o object files that should be created by compiling the files in the source file list.</p>
<h1><a class="anchor" id="devel_list_example2"></a>
Example - a directory with subdirectories</h1>
<p>We now consider the structure of a sources.mk file for a subdirectory of src/ that contains one or more enclosed subdirectories with source files. In this case, the value of the source file list variable [directory]_ is a list of paths for all of the source files in the directory tree rooted at the file that contains the source.mk file, including source files in all of its subdirectories. This list is created by concatenating source file lists defined in the source.mk files of subdirectories, and then appending any additional source files that are defined in the root directory of this tree.</p>
<p>As an example, here is the relevant part of the file src/r1d/sources.mk in the namespace level directory src/r1d: </p><div class="fragment"><div class="line">include $(SRC_DIR)/r1d/domain/sources.mk</div>
<div class="line">include $(SRC_DIR)/r1d/solvers/sources.mk</div>
<div class="line">include $(SRC_DIR)/r1d/iterator/sources.mk</div>
<div class="line">include $(SRC_DIR)/r1d/sweep/sources.mk</div>
<div class="line">include $(SRC_DIR)/r1d/misc/sources.mk</div>
<div class="line"> </div>
<div class="line">r1d_=\</div>
<div class="line">  $(r1d_domain_) \</div>
<div class="line">  $(r1d_solvers_) \</div>
<div class="line">  $(r1d_iterator_) \</div>
<div class="line">  $(r1d_sweep_) \</div>
<div class="line">  $(r1d_misc_) \</div>
<div class="line">  r1d/System.cpp \</div>
<div class="line">  r1d/SystemAccess.cpp </div>
<div class="line"> </div>
<div class="line">r1d_OBJS=\</div>
<div class="line">     $(addprefix $(BLD_DIR)/, $(r1d_:.cpp=.o))</div>
</div><!-- fragment --><p> The first segment of this file is a set of 5 include directives that instruct make to include the contains of the sources.mk files from all relevant subdirectories of src/r1d. The make "include" directive is analogous to the C/C++ #include preprocessor command, and simply instructs make to paste the contents of another file into the current file, verbatim, before parsing the current file.</p>
<p>The next section of this file assigns a value to the source file list variable r1d_. The first several lines of the value assigned to r1d_ is simple a concatentation of the corresponding source file lists for the enclosed subdirectories. Each of the source file list variables for a subdirectory is defined in the sources.mk file in that subdirectory, each of which has been included into this file. The last two lines of this assignment list two additional source files (System.cpp and <a class="el" href="SystemAccess_8cpp_source.html">SystemAccess.cpp</a>) that are located in the r1d parent directory rather than one of its subdirectories.</p>
<p>The statement that defines r1d_OBJS creates a corresponding object file list by processing the source file list, using the same text processing operations as those used in the simpler example given above for an directory with no subdirectories.</p>
<p><br  />
 <a class="el" href="developer_directory_page.html">Directory Structure</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="developer_page.html">Developer Information</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="developer_build_page.html">Build System</a> (Next) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 14 2025 16:24:04 for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
