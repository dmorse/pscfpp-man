<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: R1d::AmIterator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="index.html">PSCF - Polymer Self-Consistent Field</a></li><li class="navelem"><a href="scft_page.html">Self-Consistent Field Theory</a></li><li class="navelem"><a href="scft_iterator_page.html">Iteration Algorithms</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">R1d::AmIterator </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>An <a class="el" href="classPscf_1_1R1d_1_1AmIterator.html" title="Anderson-Mixing iterator for 1D SCFT.">R1d::AmIterator&lt;D&gt;</a> object is an iterator that solves the 1D SCFT equations using a <a class="el" href="pscf_AmIteratorTmpl_page.html">Anderson-Mixing</a> algorithm.</p>
<h1 class="doxsection"><a class="anchor" id="r1d_AmIterator_param_sec"></a>
Parameter file</h1>
<p>An example of the parameter file format for this iterator is shown below: </p><div class="fragment"><div class="line">AmIterator{</div>
<div class="line">  epsilon       1e-8</div>
<div class="line">  maxItr        100</div>
<div class="line">  maxHist       50</div>
<div class="line">  verbose       int (0-2, 0 by <span class="keywordflow">default</span>)</div>
<div class="line">  errorType     relNorm</div>
<div class="line">}</div>
</div><!-- fragment --><p> The format of this block is described more formally below: </p><div class="fragment"><div class="line"> AmIterator{</div>
<div class="line">   epsilon         real </div>
<div class="line">   maxItr*         int (200 by <span class="keywordflow">default</span>)</div>
<div class="line">   maxHist*        int (50 by <span class="keywordflow">default</span>)</div>
<div class="line">   verbose*        int (0-2, 0 by <span class="keywordflow">default</span>)</div>
<div class="line">   outputTime*     bool (<span class="keyword">false</span> by <span class="keywordflow">default</span>)</div>
<div class="line">   errorType*      string (<span class="stringliteral">&quot;norm&quot;</span>, <span class="stringliteral">&quot;rms&quot;</span>, <span class="stringliteral">&quot;max&quot;</span>, or <span class="stringliteral">&quot;relNorm&quot;</span>.  <span class="stringliteral">&quot;relNorm&quot;</span> by <span class="keywordflow">default</span>)</div>
<div class="line">   lambda*         <a class="code hl_function" href="group__Pscf__Math__Complex__Module.html#gadc3b10b3f2a06e8f2aee5527031c076b">real</a> (1.0 by <span class="keywordflow">default</span>)</div>
<div class="line">   useLambdaRamp*  bool (<span class="keyword">true</span> by <span class="keywordflow">default</span>)</div>
<div class="line">   r*              <a class="code hl_function" href="group__Pscf__Math__Complex__Module.html#gadc3b10b3f2a06e8f2aee5527031c076b">real</a> (0.9 by <span class="keywordflow">default</span>)</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Pscf__Math__Complex__Module_html_gadc3b10b3f2a06e8f2aee5527031c076b"><div class="ttname"><a href="group__Pscf__Math__Complex__Module.html#gadc3b10b3f2a06e8f2aee5527031c076b">Pscf::real</a></div><div class="ttdeci">RT real(CT const &amp;a)</div><div class="ttdoc">Return the real part of a complex number.</div></div>
</div><!-- fragment --><p> Here, as elsewhere, labels followed by an asterisk (*) represent optional parameters. The meaning of various parameters are described below, and most are also discussed as part of a more general discussion of <a class="el" href="pscf_AmIteratorTmpl_page.html">Anderson-Mixing</a> algorithms: </p><table class="doxtable">
<tr>
<td><b> <a class="el" href="classUtil_1_1Label.html" title="A label string in a file format.">Label</a> </b> </td><td><b> Description </b> </td></tr>
<tr>
<td>epsilon </td><td>Desired tolerance for convergence - iteration stops if the magnitude of the error drops below epsilon. </td></tr>
<tr>
<td>maxItr* </td><td>Maximum number of iterations that will be attempted (200 by default) </td></tr>
<tr>
<td>maxHist* </td><td>Maximum number of previous trial solutions that will be retained in memory for use by the AM algorithm (50 by default) </td></tr>
<tr>
<td>verbose* </td><td>Integer with allowed values 0-2 for the level of verbosity of output to log file during iteration. <br  />
 (0 by default). </td></tr>
<tr>
<td>showTime* </td><td>Optional boolean (0 or 1). Set true (1) to output a report of components of wall clock time during iteration, or false (0) to skip. (false by default.) </td></tr>
<tr>
<td>errorType* </td><td>Identifer for the type of scalar error compared to epsilon to test convergence. Allowed values are "norm", "rms", "max" and "relNorm", as discussed <a class="el" href="pscf_AmIteratorTmpl_page.html">here</a>. ("relNorm" by default). </td></tr>
<tr>
<td>lambda* </td><td>Mixing parameter \( \lambda \) in standard mixing <a class="el" href="pscf_AmIteratorTmpl_page.html#pscf_AmIteratorTmpl_algo_correct_sub">correction step</a> for an <a class="el" href="pscf_AmIteratorTmpl_page.html">Anderson mixing algorithm</a>. (1.0 by default) </td></tr>
<tr>
<td>useLambdaRamp* </td><td>If true, ramp-up the mixing parameter during first few iterations, as discussed <a class="el" href="pscf_AmIteratorTmpl_page.html#pscf_AmIteratorTmpl_algo_correct_sub">here</a>. (true by default) </td></tr>
<tr>
<td>r* </td><td>Ratio \( r \) used in formula for mixing parameter ramp factor, as discussed <a class="el" href="pscf_AmIteratorTmpl_page.html#pscf_AmIteratorTmpl_algo_correct_sub">here</a>. (0.9 by default) </td></tr>
</table>
<p>The iterative loop exits if the number of iterations has reached maxItr or if the magnitude of the scalar error is less than epsilon.</p>
<p><b> errorType </b>: Several different definitions may be used for the scalar error, depending on the value of the identifier errorType.</p>
<ul>
<li>If errorType == norm, then the scalar error is take to be the L2 norm of the residual vector defined below (i.e., the sum of the squares of all residual elements).</li>
<li>If errorType == rms, then the scalar error is the root mean squared magnitude per element. This is equal to the L2 norm divided by the square root of the number of elements.</li>
<li>If errorType == max, then the scalar error is take to be the maximum of the absolute magnitude of the elements of the residual vector (the L infinity norm of the residual vector).</li>
<li>If errorType == norm, then the scalar error is take to be the ratio of the L2 norm of the residual vector to the L2 norm of the w field, as in Stasiak and Matsen, Eur. Phys, Journel E, 2012.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="r1d_AmIterator_residual_sec"></a>
Residual definition</h1>
<p>The algorithm is designed to reduce the values of the elements of a vector of residuals (i.e., errors) until they are zero to within some tolerance, as defined by one of the scalar norms discussed above. The definition of the vector of residuals used in this algorithm is analogous to that given in Eq. (10) of the article by Arora et al. [Arora, Morse, Bates and Dorfman, J. Chem. Phys. vol. 146 224902 (2017)]. The main difference is that here residual values are associated with values at grid points, rather than coefficients in the Fourier expansion used in the algorithm described in that reference. To describe the residuals expressions here, we use zero based indexing for monomer types, use \( N_{x} \) to denote the number of grid points (referred to in the parameter file and source code as nx), and use \( N_{m} \) to denote the number of monomer types (referred to elsewhere as nMonomer).</p>
<p>The vector of residuals for a pscf_1d calculation has \( N_{x}N_{m} \) (or nx * nMonomer) scalar residuals. Let \( w_{ia} \) and \( \phi_{ai} \) denote the values of the chemical potential field \( w_{i} \) and volume fraction \( \phi_{i} \) for monomer type i at grid point \(a\), respectively, The corresponding residual component \( R_{ai}\) associated with grid point \( a \) and monomer type \( i \) is given, by analogy to Eq. (10) of Arora et al. (JCP 2017), as     </p><p class="formulaDsp">
\[  R_{ai} = \sum_{j=0}^{N_{m}-1} 
           \left ( \chi_{ij} \phi_{aj} - P_{ij}w_{aj} \right ) 
  \quad.
\]
</p>
<p> where \( P_{ij} \) is an element of an idempotent \( N_{m} \times N_{m} \) matrix \(  P \) that can be expressed in matrix notation as      </p><p class="formulaDsp">
\[  P  = I
  - \frac{\epsilon \epsilon^{T} \chi^{-1} }
        { \epsilon^{T} \chi^{-1} \epsilon }
 \quad.
\]
</p>
<p> Here, \( I \) is the identity matrix, \( \chi^{-1} \) is the matrix inverse of the \(\chi\) matrix, and \(\epsilon\) is a \( N_{m} \)-component column vector with elements given by \( \epsilon_{i} = 1 \) for all \( i = 0, \ldots, N_{m}-1 \).</p>
<h1 class="doxsection"><a class="anchor" id="r1d_AmIterator_closed_sec"></a>
Closed systems (canonical ensemble)</h1>
<p>A slight modification of the residual definition is required in the case when a value of phi rather than mu is specified for every molecular species, giving a closed system, or a canonical statistical ensemble. In this case, the solution of the SCF problem is not unique, becase the values of the residuals defined above can be shown to be invariant under a shift in all of the chemical potential fields at all grid point points by any spatially homgeneous constant. To obtain a unique solution, the update procedure shifts the chemical potential fields so as to guarantee that the w field value for the last monomer type at the last grid point is forced to equal zero by convention. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on <span class="timestamp"></span> for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
