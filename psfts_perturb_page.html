<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: Perturbations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">PSCF - Polymer Self-Consistent Field Theory</a></li><li class="navelem"><a class="el" href="psfts_page.html">Partial Saddle-Point Field Theoretic Simulation (PS-FTS)</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Perturbations</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="psfts_ramp_page.html">Parameter Ramps</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="developer_page.html">Developer Information</a> (Next) <br  />
</p>
<p>A perturbation is an optional feature that allows a user to define a modification of the form of the standard field theoretic Hamiltonian. Thus far, it has only been used as a framework for implementing the Einstein crystal method of computing free energies.</p>
<h1><a class="anchor" id="psfts_perturb_concept_sec"></a>
Perturbation Concept</h1>
<p>Any perturbation of the Hamiltonian must be implemented by a subclass of a base class named Perturbation. A Perturbation defines a functional of the fields, denoted here by \( H_{1} \), that is added to the standard Hamiltonian \( H_{0} \) to obtain a total Hamiltonian \( H_{0} + H_{1} \). The perturbation Hamiltonian must depend upon a single real parameter, denoted by \( \lambda \), giving a modified Hamiltonian of the form   </p><p class="formulaDsp">
\[
   H(\lambda) = H_{0} + H_{1}(\lambda)
\]
</p>
<p> A Perturbation class must provide methods to compute \( H_{1} \), and to compute its functional derivatives with respect to the fields (which are needed to compute forces in Brownian dynamics simulation) and the the partial derivative of \( H_{1} \) with respect to the parameter \( \lambda \) at fixed field values (which is needed for thermodynamic integration).</p>
<p>A perturbation is an optional element of a simulation that may be added by including a Perturbation subblock of the BdSimulator or McSimulator block of a parameter file. If present, the Perturbation block must appear immediately after the Compressor block (if any). Full descriptions of formats of for the BdSimulator and McSimulator parameter file blocks are given <a class="el" href="rpc_BdSimulator_page.html">here</a> and <a class="el" href="rpc_McSimulator_page.html">here</a>, respectively.</p>
<p>The PerturbationDerivative analyzer class is designed to enable thermodynamic integration with respect to the \( \lambda \) parameter associated with a perturbation. This analyzer is designed to work with any subclass of Perturbation, and relies on the fact that any such Perturbation is required to define a functions to compute the value of the partial derivative \( \partial H_{1} / \partial \lambda \) . The PerturbationDerivative class provides tools to periodically evaluate this partial derivative, compute its time average, and write values or block averages of this quantity to a file.</p>
<p>Continuous thermodynamic integration with respect to the parameter lambda asssociated with a perturbation may be performed by using the parameter type <em>lambda_pert</em> in the parameter block for the ramp to perform. A ramp that uses this parameter type performs a linear variation of the lambda parameter over the course of a simulation, as discussed <a class="el" href="rpc_LinearRamp_page.html#rpc_LinearRamp_perturbation_sec">here</a> . The implementation of this feature of the LinearRamp class only uses the interface defined by the Perturbation base class, and so is designed to work with any type of perturbation (i.e., any subclass of this base class).</p>
<h1><a class="anchor" id="psfts_perturb_einstein_sec"></a>
Einstein Crystal Perturbation</h1>
<p><b> EinsteinCrystalPerturbation </b>: The only type of Perturbation that is provided with PSCF v1.2 is a class named EinsteinCrystalPerturbation that enables calculation of free energies by the Einstein crystal method. The resulting perturbation is a functional of the form   </p><p class="formulaDsp">
\[
   H_{1}(\lambda) = (1 - \lambda)( H_{{\rm EC}} - H_{0} )
\]
</p>
<p> in which \( H_{0} \) is the standard unperturbed Hamiltonian functional, \( H_{{\rm EC}} \) is the Hamiltonian for an Einstein crystal model (described below), and \( \lambda \) is a parameter that must be in the range \( 0 \leq f \leq 1 \).</p>
<p>In the common case of a standard AB system with \( \chi &gt; 0 \), the EinsteinCrystalPerturbation class defines a harmonic functional     </p><p class="formulaDsp">
\[
   H_{{\rm EC}} = \frac{1}{v\epsilon} 
                \int \! d {\bf r} \;
                [ W_{-}({\bf r}) - W^{({\rm r})}_{-}({\bf r}) ]^2
\]
</p>
<p> in which \( W^{({\rm r})}_{-}({\bf r}) \) is a reference exchange field provided by the user and \( \epsilon \) is a scalar parameter that controls the magnitude of fluctuations. The \( \epsilon \) parameter for a standard AB system is set equal to \( \chi \) by default, and this default setting is used in the example given below. Generalization of the Einstein crystal Hamiltonian to cases with more than two monomer types, and the full parameter file format for the class are discussed in <a class="el" href="rpc_EinsteinCrystalPerturbation_page.html">manual page</a> for the EinsteinCrystalPerturbation class.</p>
<p>When a perturbation of this form is added to the unperturbed Hamiltonian \( H_{0} \), it yields a total Hamiltonian   </p><p class="formulaDsp">
\[
  H(\lambda) = \lambda H_{0} + (1-\lambda) H_{{\rm EC}}
\]
</p>
<p> By construction, \( H(\lambda) \) is thus equal to the Einstein crystal Hamiltonian \( H_{{\rm EC}} \) when \( \lambda = 0 \) and equal to the unperturbed Hamiltonian \( H_{0} \) when \( \lambda = 1 \). The derivative of \( H(\lambda) \) with respect to \( \lambda \), which is used in thermodynamic integration, is given by the difference    </p><p class="formulaDsp">
\[
   \frac{\partial H_{1}(\lambda)}{\partial \lambda}
   =  H_{0} - H_{{\rm EC}}
\]
</p>
<p> where the partial derivative is evaluated at fixed field values.</p>
<p>The parameter file block for an EinsteinCrystalPerturbation requires a user to enter a value for the perturbation parameter \( \lambda \), and the name of a file that contains the reference field configuration in r-grid format, as described <a class="el" href="rpc_EinsteinCrystalPerturbation_page.html">here</a>. The reference field configuration is usually taken to be a SCFT solution for the phase of interest. When applied to a disordered phase, this reference field normally contains spatially homogeneous fields.</p>
<p><b> Thermodynamic Integration </b>: The EinsteinCrystalPerturbation and PerturbationDerivative classes must be used together to compute free energies by the Einstein crystal method. When applied to a standard AB system, with chi(0,0) = chi(1,1) = 0.0 and \( \chi = \) chi(0,1) = chi(1,0), with the default choice of \( \epsilon = \chi \), the free energy \( F \) of the interacting system with \( \lambda = 1 \) can be expressed as a sum      </p><p class="formulaDsp">
\[
   F = H_{0}^{({\rm r})} + \int\limits_{0}^{1}\! d \lambda \;
       \left \langle
        \frac{\partial H(\lambda)}{\partial \lambda}
        \right \rangle \quad.
\]
</p>
<p> in which \( H_{0}^{({\rm r})} \) denotes the value of the standard unperturbed Hamiltonian in the reference state used by the Einstein crystal Hamiltonian. In this expression, the value of the integrand at each value of \( \lambda \in [0, 1]\) is an equilibrium average for a system governed by a perturbed Hamiltonian \( H(\lambda) \rangle \).</p>
<p>The required integral with respect to \( \lambda \) can be evaluated by either of two methods:</p>
<ul>
<li><b> Multiple equilibrium simulations </b>: Perform separate equilibrium simulations with an EinsteinCrystalPerturbation at multiple values of \( \lambda \in [0,1] \) and use a standard numerical integration scheme to approximate the integral. For example, one can obtain the integral over \( [0, 1] \) or any subinterval thereof by performing simulations at an odd number of evenly spaced values of \( \lambda \) (including the endpoints) that divide the interval into an even number of subintervals, and then use Simpson's rule for integration.</li>
<li><b> Continuous integration </b>: Perform a very slow linear ramp of \( \lambda \) from 0 to 1 by using the LinearRamp class with a parameter of type lambda_pert. The integral can then be approximated by the time average of \( \partial H(\lambda)/\partial \lambda \) over the course of this ramp.</li>
</ul>
<p>Ramps can also be applied to subdomains of the domain \( [0 1] \) in order to use different ramp rates over different ranges. When computing the free energy of an ordered phase using an inhomogeneous reference field, special attention to accuracy is required for a range of values near the final value \( \lambda = 1 \). In either method, the required values of \( \partial H(\lambda)/\partial \lambda \) can be sampled by the PerturbationDerivative analyzer.</p>
<h1><a class="anchor" id="psfts_perturb_example_sec"></a>
Example: Continuous Einstein Crystal Integration</h1>
<p>Below, we show a complete parameter file for a calculation that uses continuous Einstein crystal integration to compute a free energy difference.</p>
<div class="fragment"><div class="line">System{</div>
<div class="line">  Mixture{</div>
<div class="line">    nMonomer  2</div>
<div class="line">    monomers[</div>
<div class="line">             1.0  </div>
<div class="line">             1.0 </div>
<div class="line">    ]</div>
<div class="line">    nPolymer  1</div>
<div class="line">    Polymer{</div>
<div class="line">      type    linear</div>
<div class="line">      nBlock  2</div>
<div class="line">      blocks[</div>
<div class="line">              0   0.5</div>
<div class="line">              1   0.5</div>
<div class="line">      ]</div>
<div class="line">      phi     1.0</div>
<div class="line">    }</div>
<div class="line">    vMonomer  0.01</div>
<div class="line">    ds   0.02</div>
<div class="line">  }</div>
<div class="line">  Interaction{</div>
<div class="line">    chi(</div>
<div class="line">        1   0   14.0</div>
<div class="line">    )</div>
<div class="line">  }</div>
<div class="line">  Domain{</div>
<div class="line">    mesh         40    40    40</div>
<div class="line">    lattice      cubic   </div>
<div class="line">  }</div>
<div class="line">  BdSimulator{</div>
<div class="line">    seed           486893701</div>
<div class="line">    BdStep{</div>
<div class="line">      mobility  5.0E-2</div>
<div class="line">    }</div>
<div class="line">    Compressor{</div>
<div class="line">      epsilon      1.0e-4</div>
<div class="line">      maxHist      40</div>
<div class="line">    }</div>
<div class="line">    EinsteinCrystalPerturbation{</div>
<div class="line">      lambda           0.0</div>
<div class="line">      fieldFileName    in/ecReference.rf</div>
<div class="line">    }</div>
<div class="line">    Ramp{</div>
<div class="line">      nParameters  1 </div>
<div class="line">      parameters[</div>
<div class="line">         lambda_pert    1.0</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">    AnalyzerManager{</div>
<div class="line"> </div>
<div class="line">      StepLogger{</div>
<div class="line">        interval         50</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      PerturbationDerivative{</div>
<div class="line">        interval          5</div>
<div class="line">        outputFileName    out/derivative</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b> Discussion </b>: The main new elements in this example, compared to simpler previous examples, are the presence of an EinsteinCrystalPerturbation block and a PerturbationDerivative analyzer, as well as a linear Ramp that is used to perform continuous integration. Here, we have used generic block labels BdStep, Compressor, and Ramp to select default algorithms for these blocks, but have used the specific class name EinsteinCrystalPerturbation for the Perturbation block. Because EinsteinCrystalPerturbation is the default perturbation algorithm, we could instead have used a generic label Perturbation for this block without changing the result.</p>
<p>In the EinsteinCrystalPerturbation block, we set an initial value lambda = 0.0 for the perturbation parameter, corresponding to a pure Einstein crystal Hamiltonian. The epsilon parameter has been set equal to the value 14.0 that is assigned to chi(0,1) in the interaction block, using the convention alpha = chi(0,1) recommended above. The reference field is read from an r-grid field file named ecReference.rf in subdirectory in/ of the current working directory (i.e., the directory from which the program was invoked).</p>
<p>The Ramp block uses the parameter identifier lambda_pert to indicate that the lambda parameter of the associated Perturbation should be varied, and gives a range 1.0 to creat a ramp from the initial value of 0 to a final value of 1.0.</p>
<p>In the <a class="el" href="rpc_PerturbationDerivative_page.html">PerturbationDerivative</a> block of the AnalyzerManager, this analyzer is programmed to sample the partial derivative \( \partial H/\partial \lambda \) every 5 simulation steps, and to output every sampled value to a file. The file name out/derivative will be used as a base file name for the file containing these sampled values and for another file that contains information about the time average.</p>
<h1><a class="anchor" id="psfts_perturb_seealso_sec"></a>
See Also:</h1>
<ul>
<li>
<a class="el" href="rpc_EinsteinCrystalPerturbation_page.html">EinsteinCrystalPerturbation</a>  </li>
<li>
<a class="el" href="rpc_PerturbationDerivative_page.html">PerturbationDerivative</a>  </li>
</ul>
<p><br  />
 <a class="el" href="psfts_ramp_page.html">Parameter Ramps</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="psfts_page.html">Partial Saddle-Point Field Theoretic Simulation (PS-FTS)</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="developer_page.html">Developer Information</a> (Next) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 14 2025 16:24:04 for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
