<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: Thin-Film Confinement</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="index.html">PSCF - Polymer Self-Consistent Field</a></li><li class="navelem"><a href="scft_page.html">Self-Consistent Field Theory</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Thin-Film Confinement </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="scft_environment_page.html">Environments &ndash; Confinement and External Fields</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="scft_visualize_page.html">Visualization</a> (Next) <br  />
</p>
<p>Thin-film confinement can be imposed on the PSCF unit cell by including a FilmEnvironment block in the parameter file, above the Iterator block. See <a class="el" href="scft_environment_page.html">this previous page</a> for more general information about Environments and for a description of how masks and external potential fields are implemented in PSCF. On this page, we first explain the model used to represent thin film confinement, followed by an explanation of how a user can impose the constraint in PSCF.</p>
<p>If you use this tool in your research, please cite the following paper in which the tool was first presented:</p><ul>
<li>Magruder, Morse, Ellison, Dorfman (2024). <em>ACS Macro Letters</em>, <b>382</b>, 084902.</li>
</ul>
<p>More detail about the tool and the model can also be found in this subsequent paper:</p><ul>
<li>Magruder, Ellison, Dorfman (2024). <em>Journal of Chemical Physics</em>, <b>161</b>, 084902.</li>
</ul>
<p>For further reading on thin film SCFT, see the two publications listed below, on which our implementation is largely based:</p><ul>
<li>Matsen, M. W. (1997). <em>J. Chem. Phys.</em>, <b>106</b>, 7781.</li>
<li>Khanna, V., <em>et al.</em> (2006). <em>Macromolecules</em>, <b>39</b>, 9346.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="scft_films_functional_sec"></a>
Functional form of the imposed fields</h1>
<p>The thin film is modeled as a polymer melt confined between two parallel walls with a fixed distance between them. The mask that is used to enforce this confinement prohibits the polymers from occupying the space inside of these walls. Additionally, chemical interactions between the walls and the monomer species are modeled using external fields that are imposed at the polymer/wall interface.</p>
<p>The mask field \( m({\bf r}) \) that we use to impose a thin film geometry is defined to have a sigmoidal shape that rapidly rises from zero to one at the polymer/wall interfaces, with the walls located on opposite sides of the unit cell and the polymer located in the middle. Formally, we write the mask as    </p><p class="formulaDsp">
\[   m(z) = 1 - 0.5*\left( 1+ {\rm tanh} 
   \left( 4*\frac{.5(T-L)+|z-\frac{L}{2}|}{t} \right) \right)
\]
</p>
<p> Here, we have written the mask density as a function of <em>z</em>, which we define as the position along the direction normal to the walls. <em>L</em> is the length of the unit cell in this direction, and <em>T</em> is the total thickness of the wall in this direction (i.e., the "excluded" thickness where \( m({\bf r}) &lt; 0.5 \)). <em>t</em> defines the rate at which \( m(z) \) decays from 1 to 0 when passing from the film region into the wall. If <em>t</em> is small, the calculation will require high spatial resolution to converge, which can be computationally prohibitive, but a large value of <em>t</em> may not be an accurate representation of a rigid film boundary. A common compromise in literature is to choose \( 0.15R_g \le t \le 0.5R_g \), where \( R_g \) is the radius of gyration of the polymer (for a one-component system).</p>
<p>The chemical potential fields are defined by a Flory&ndash;Huggins-like <em>&chi;</em> interaction parameter between each monomer species and the walls, where the wall volume fraction is defined as \( 1-m({\bf r}) \). We define a "top" and a "bottom" wall which can have different interaction parameters, where the "bottom" wall is that which contains the unit-cell origin. Formally, this is written as        </p><p class="formulaDsp">
\[   h_{\alpha}(z) = \left\{
   \begin{array}{ll} \chi_{\alpha,{\rm bot}} (1-m({\bf r})) &amp; 
   {\rm for} \: z &lt; L/2 \\
   \chi_{\alpha,{\rm top}} (1-m({\bf r})) &amp; 
   {\rm for} \: z \ge L/2 \end{array}
   \right.
\]
</p>
<p> where \( \chi_{\alpha,{\rm bot}} \) and \( \chi_{\alpha,{\rm top}} \) are the interaction parameters between species \(\alpha\) and the bottom wall and top wall, respectively.</p>
<h2 class="doxsection"><a class="anchor" id="scft_films_unitcell_sec"></a>
Constraint on the unit-cell shape</h2>
<p>Although it is not strictly necessary, we impose an additional constraint on the unit cells used for thin film calculations in order to simplify the construction and interpretation of the mask: one lattice basis vector must be oriented normal to the walls, and all other lattice basis vectors must be parallel to the walls. It does not matter which basis vector is normal to the walls, as long as all basis vectors satisfy this requirement. For example, if one were to use a hexagonal unit cell in 3D, the walls must be parallel to the <b>a</b> and <b>b</b> lattice vectors, because this is the only orientation of the walls for which the third lattice vector is normal to the walls. <br  />
</p>
<p>The space group used to describe the system must accurately describe the symmetry of the mask and the external fields within a unit cell that satisfies the constraints described here. Determining the proper space group can be difficult in some cases, so an entire section is dedicated to this topic <a class="el" href="#scft_films_space_groups_sec">below.</a></p>
<p>By default, the length of the lattice vector that is normal to the walls is not allowed to vary, so the film thickness will be held constant throughout the calculation. The lattice parameters that define the size of the unit cell in the plane of the film are allowed to vary just as they would in a bulk SCFT calculation, if the user chooses a flexible unit cell. PSCF will automatically hold the film thickness parameter constant, so the user does not have to set it to rigid manually.</p>
<p>PSCF does, however, provide a feature that allows the film thickness to be optimized within a single SCFT calculation. This feature is an implementation of the "dynamic mask method" developed by Magruder and Dorfman (2025). The method is explained in more detail <a class="el" href="#scft_films_dynamic_sec">below.</a></p>
<h1 class="doxsection"><a class="anchor" id="scft_films_param_file_sec"></a>
Parameter file input</h1>
<p>In the parameter file, the thin film constraint is included by adding a FilmEnvironment block that precedes the Iterator block. In this section, we consider an example system that one might wish to study: a bcc morphology in a thin film that is 2 unit cells thick, with walls that are normal to the <b>c</b> lattice basis vector. We provide a parameter file for this example, followed by a discussion of all key details of this parameter file that pertain to the thin-film constraint. The parameter file will look like the following: </p><div class="fragment"><div class="line">System{</div>
<div class="line">   Mixture{</div>
<div class="line">      ...</div>
<div class="line">   }</div>
<div class="line">   Interaction{</div>
<div class="line">      ...</div>
<div class="line">   }</div>
<div class="line">   Domain{</div>
<div class="line">      mesh             32  32  128</div>
<div class="line">      lattice          tetragonal</div>
<div class="line">      groupName        P_4%m_m_m</div>
<div class="line">   }</div>
<div class="line">   FilmEnvironment{</div>
<div class="line">      normalVecId         2</div>
<div class="line">      interfaceThickness  0.2</div>
<div class="line">      excludedThickness   0.4</div>
<div class="line">      chiBottom[</div>
<div class="line">                          0</div>
<div class="line">                          10</div>
<div class="line">      ]</div>
<div class="line">      chiTop[</div>
<div class="line">                          0</div>
<div class="line">                          10</div>
<div class="line">      ]</div>
<div class="line">   }</div>
<div class="line">   Iterator{</div>
<div class="line">      epsilon      1e-6</div>
<div class="line">      maxItr       100</div>
<div class="line">      maxHist      50</div>
<div class="line">      isFlexible   1</div>
<div class="line">   }</div>
<div class="line">   LinearSweep{</div>
<div class="line">      ns            20  </div>
<div class="line">      baseFileName  out/</div>
<div class="line">      reuseState    0</div>
<div class="line">      nParameter    3</div>
<div class="line">      parameters[</div>
<div class="line">                    cell_param  1   +1.0</div>
<div class="line">                    chi_bottom  1  -10.0</div>
<div class="line">                    chi_top     1  -10.0</div>
<div class="line">      ]   </div>
<div class="line">   }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="scft_films_domain_sec"></a>
Domain block</h2>
<p>First, we draw your attention to the <span class="tt">Domain</span> block. Notice that this differs significantly from the <span class="tt">Domain</span> block that would be expected for a bcc structure in a neat melt. The space group has been downgraded from the cubic <em>Im</em>-3<em>m</em> group to tetragonal <em>P</em>4/<em>mmm</em>. See the <a class="el" href="#scft_films_space_groups_sec">space groups</a> section below for more information about determining the appropriate space group symmetry for a thin film. Also notice that we have chosen specific and intentional values for the mesh discretization in the <b>c</b> direction, with 4x more gridpoints than in the other directions. The gridpoint density required to resolve the polymer/wall interface is, as a good rule of thumb, about 2-3x that of a bulk SCFT phase, and the film is two unit cells thick (while only being one unit cell wide in the <b>a</b> and <b>b</b> directions), hence the 4x higher gridpoint density.</p>
<h2 class="doxsection"><a class="anchor" id="scft_films_iterator_sec"></a>
FilmEnvironment block</h2>
<p>Now, we proceed to the <span class="tt">FilmEnvironment</span> block. The parameters contained in this block are those that are necessary to define the imposed fields.</p>
<h3 class="doxsection"><a class="anchor" id="scft_films_normalvecid_sec"></a>
normalVecId</h3>
<p>The first of these required parameters is <span class="tt">normalVecId</span>, indicating which of the 3 lattice basis vectors is oriented normal to the walls. The input should be either 0, 1, or 2, corresponding to the <b>a</b>, <b>b</b>, or <b>c</b> lattice vectors, respectively. In the example above, the <b>c</b> vector is normal to the wall. Importantly, the two vectors that are <em>not</em> normal to the wall (<b>a</b> and <b>b</b> in this example) must be parallel to the wall. So, if <b>c</b> is normal to the wall, then the unit cell angles <em>&alpha;</em> and <em>&beta;</em> must both be 90&deg;. The software will throw an Exception if this condition is not met.</p>
<h3 class="doxsection"><a class="anchor" id="scft_films_thickness_sec"></a>
interfaceThickness and excludedThickness</h3>
<p>The next required inputs are <span class="tt">interfaceThickness</span> and <span class="tt">excludedThickness</span>, which correspond to <em>t</em> and <em>T</em> in the expression for \(m(z)\) above, respectively. These values are defined in the same units as other length inputs (unit cell parameters, segment lengths). In the example, we have chosen <em>t</em> to be 0.2, or ~ \(0.49R_g\) based on information from the <span class="tt">Mixture</span> block, and we have chosen <em>T</em> to be 0.4, or ~ \(0.98R_g\).</p>
<p>Let us also briefly consider the parameter <em>L</em> (the length of the unit cell in the direction normal to the wall) in the context of the example parameter file above, now that we have defined <em>T</em>. Since we have declared that the <b>c</b> lattice basis vector is orthogonal to the wall, the length of <b>c</b> is equivalent to <em>L</em>. The parameter <em>L</em> is thus not defined in the parameter file, and can instead be found in the input field file. Because of the presence of the walls, the thickness of the actual polymer/solvent film is instead equal to <em>L&ndash;T</em>, or 4.0. If we expect that the bcc structure will have a cubic lattice parameter of ~2.0, then we can target a film that is two unit cells thick by setting the lattice parameters to 2.0 (for <em>a</em>) and 4.4 (for <em>c</em>) in the field file. The latter parameter will not be allowed to vary in the calculation, because it defines the film thickness.</p>
<p>This is an important distinction that may be somewhat confusing at first; the <span class="tt">excludedThickness</span> parameter in the parameter file defines the region of the unit cell that does <b>not</b> contribute to the film thickness, while the film thickness itself is defined via the lattice parameters in the field file. This makes it easy to perform parameter sweeps that vary the film thickness, because the lattice parameters can be varied and a new mask will be generated at each sweep step with a consistent value of excludedThickness used at each step. It also ensures that the excludedThickness is always set to an appropriate value, and will never accidentally drift to be too small or unnecessarily large.</p>
<h3 class="doxsection"><a class="anchor" id="scft_films_chi_sec"></a>
chiBottom and chiTop</h3>
<p>Next, there are required input arrays <span class="tt">chiBottom</span> and <span class="tt">chiTop</span>. These allow the user to define the Flory&ndash;Huggins-like interaction parameter between each monomer species and the walls. For a system with <span class="tt">n</span> monomer species, the chi arrays will contain <span class="tt">n</span> entries each. Each entry corresponds to a single monomer species, in the same order that they are listed in the <span class="tt">monomers[</span> block. <span class="tt">chiBottom</span> defines the interaction between each species and the lower wall (defined as the wall that contains the origin of the unit cell), while 'chiTop' defines the interactions with the upper wall.</p>
<p>In the example above, we have two monomer species, with species indices 0 and 1. Both walls interact more favorably with the monomer species with index 0. If <span class="tt">chiBottom</span> and <span class="tt">chiTop</span> are identical then the walls are said to be "chemically identical," which is the case for this example.</p>
<p>The wall chi parameters are computational analogs to the physical property of interfacial tension. The interfacial tension between a given monomer species and the wall can be related to the corresponding wall chi parameter using a procedure outlined in the following reference from Hur and coworkers:</p>
<ul>
<li>Hur, S.-M., Garcia-Cervera, C. J., &amp; Fredrickson, G. H. (2012). Macromolecules*, <b>45</b>, 2905.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="scft_films_sweep_sec"></a>
Sweep block</h2>
<p>We also briefly draw your attention to the Sweep block at the bottom of the example parameter file. To make it easier to efficiently explore the state space of thin film polymer systems, we have introduced three sweep parameters that are specific to thin film systems. First is <span class="tt">cell_param</span>, which allows for a sweep to be performed on any lattice parameter. The syntax for this sweep parameter is <span class="tt">cell_param  i  delta</span> where <span class="tt">i</span> is the index of the lattice parameter to be swept (starting from 0) and <span class="tt">delta</span> is the desired change in this parameter over the entire sweep. Note that <span class="tt">i</span> refers to the index of the parameter in the array that is input in the <span class="tt">unitCell</span> line of the parameter file. So, in the example above, <span class="tt">i</span> can only be 0 or 1 because there are only 2 lattice parameters specified on the <span class="tt">unitCell</span> line. Also note that the lattice parameter being swept should be held rigid during the calculation, or else the iterator will allow that parameter to relax back to it's most optimal value at each step of the sweep.</p>
<p>The second and third sweep parameters for thin films are <span class="tt">chi_bottom</span> and <span class="tt">chi_top</span>, which allow the user to sweep any of the values in the <span class="tt">chiBottom</span> and <span class="tt">chiTop</span> arrays. The syntax for the <span class="tt">chi_bottom</span> sweep parameter is <span class="tt">chi_bottom  i  delta</span> where <span class="tt">i</span> specifies the array index of the chi value that will be swept (indexing starting from 0), and <span class="tt">delta</span> is the desired change in this parameter over the entire sweep. <span class="tt">i</span> must be less than n_monomer. Replace <span class="tt">chi_bottom</span> with <span class="tt">chi_top</span> to sweep a value in the <span class="tt">chiTop</span> array instead.</p>
<p>In the example parameter file above, we show how one would perform a sweep along all three thin film sweep parameters at once; we sweep the <em>c</em> lattice parameter from 4.4 to 5.4, and simultaneously sweep <span class="tt">chiBottom[1]</span> and <span class="tt">chiTop[1]</span> from 10 to 0. Note that we chose a sweep that keeps the walls chemically identical, because asymmetric walls would break the symmetry of the space group that we've chosen, so we'd need to switch to a different space group to model bcc with asymmetric walls.</p>
<p>Finally, notice that there is an additional line in the Sweep block: <span class="tt">reuseState 0</span>. The reuseState feature typically improves convergence time for sweeps by using the last few iterations of the previous sweep step as the initial "histories" for the current sweep step. However, this feature actually worsens convergence time when paired with a thin film thickness (<span class="tt">cell_param</span>) sweep, and thus we include <span class="tt">reuseState 0</span> in the param file to turn off the feature when sweeping film thickness.</p>
<h2 class="doxsection"><a class="anchor" id="scft_films_t_sec"></a>
The effect of the parameter t</h2>
<p>It is important to note that the free energy contribution arising from polymer/wall interactions has an inherent linear dependence on <em>t</em>. For instance, consider a homopolymer melt where the polymer volume fraction is equal to \( m({\bf r}) \) everywhere, and both walls are chemically identical with \( \chi_{\rm A,bot}=\chi_{\rm A,top}=\chi_{\rm A,wall} \). Then, the free energy per monomer reference volume has the following contribution from interactions with the external field:      </p><p class="formulaDsp">
\[   \tilde{f}_{\rm ext}=
   \frac{1}{\overline{m}V}
   \chi_{\rm A,wall}
   \int d{\bf r}\,m({\bf r})(1-m({\bf r}))
\]
</p>
<p> Using the expression for \( m({\bf r}) \) above, one can show that the integral of \( m({\bf r})(1-m({\bf r})) \) is proportional to <em>t</em>. As such, the strength of the interactions between polymers/solvents and walls is dependent not only on \( \chi_{\rm A,wall} \) but also on <em>t</em>. Because of this, it is strongly recommended to use the same value of <em>t</em> for all calculations that are to be compared to one another.</p>
<h2 class="doxsection"><a class="anchor" id="scft_films_flexible_sec"></a>
Variable lattice parameters</h2>
<p>As mentioned above, when walls are added into the system, the user can still choose whether to fix the unit cell parameters or allow some or all of them to vary, but the implementation is slightly different. Specifically, we require by default that the length of the lattice basis vector that is orthogonal to the wall is fixed regardless of the inputs provided in <span class="tt">isFlexible</span> and <span class="tt">flexibleParams</span>, in order to force the thin film to maintain a constant thickness throughout the iteration process. Furthermore, we require that the other lattice basis vector(s) remain parallel to the walls. This implies the following:</p><ul>
<li>In 1D, the size of the unit cell is always fixed.</li>
<li>In 2D, the length of the lattice basis vector parallel to the walls (either <b>a</b> or <b>b</b>) may vary, but the angle <em>&gamma;</em> between <b>a</b> and b** is always fixed at 90&deg;. The lattice basis vector perpendicular to the walls is fixed.</li>
<li>In 3D, the lengths of the lattice basis vectors that are parallel to the walls may vary, as can the angle between them. The two vectors in question depend on the choice of <span class="tt">normalVecId</span>. The length of the lattice basis vector that is normal to the wall (the vector indicated by <span class="tt">normalVecId</span>) is held fixed, and the remaining two angles are fixed at 90&deg;.</li>
</ul>
<p>This behavior is implemented automatically. If the user specifies that some or all lattice parameters may vary (as in the example parameter file above), then the software will decide which lattice parameters are actually allowed to vary based on <span class="tt">normalVecId</span> and <span class="tt">unitCell</span>. If the user tries to define a unit cell that is incompatible with the rules above (<em>e.g.,</em> a 2D unit cell with <em>&alpha;</em> &ne; 90&deg;), the software will throw an error.</p>
<p>The exception to this is if the user includes the optional input parameter <span class="tt">fBulk</span>, in which case the film thickness can be optimized within an SCFT calculation. This is described in more detail <a class="el" href="#scft_films_dynamic_sec">below.</a></p>
<h1 class="doxsection"><a class="anchor" id="scft_films_space_groups_sec"></a>
Space groups</h1>
<p>Although we are imposing a thin film constraint on the system, we still use periodic boundary conditions in all directions so that the symmetry-adapted basis functions used for bulk (non-thin film) calculations can be used without modification. It is therefore still ideal to use the highest possible space-group symmetry to describe the system under consideration in order to reduce computational expense and minimize the effect of numerical errors. However, the presence of a mask and external fields reduces the number of allowed symmetry operations for these unit cells, because the only allowed symmetry operations are those that describe every relevant field in the system: the mask, the external fields, and the polymer morphology. Thus, the selection of the appropriate space group for a thin film requires more substantial thought than is the case for bulk systems.</p>
<h2 class="doxsection"><a class="anchor" id="scft_films_correct_sg_sec"></a>
Identifying the correct space group</h2>
<p>The appropriate space group for a desired system can be identified by looking at the symmetry operations for the space group that describes the system in the bulk, removing those operations that are not allowed in the thin film (which differ depending on whether the walls are identical or not), and then finding the space group that contains only those symmetry operations that remain. This procedure is described in the supporting information of the following manuscript, and is repeated here for convenience:</p><ul>
<li>Magruder, B. R., <em>et al.</em> (2024). <em>Journal of Chemical Physics</em>, <b>161</b>, 084902.</li>
</ul>
<p>If, for example, the walls are in the <em>x-y</em> plane (param file contains "<span class="tt">normalVecId&#160;&#160;2</span>.") and the two walls are chemically identical, then symmetry operations that change <em>z</em> to <em>-z</em> are allowed because the walls are mirror images of each other. All other changes in <em>z</em> (<em>e.g.</em>, from <em>z</em> to <em>z</em>+1/2 in reduced coordinates) are forbidden, because these operations would result in the wall being moved to a different location than where it started. If the walls are chemically dissimilar, then the only symmetry operations that are permitted are those that leave z* unchanged. So, in order to identify the space group for a thin-film system, one should start from the space group that describes the 3-dimensionally periodic polymer morphology in the absence of the walls, remove all symmetry operations that do not satisfy the above requirements, and then identify the space group that contains the remaining symmetry operations, which is the space group of the thin-film unit cell.</p>
<p>Tools are available at <a href="https://www.cryst.ehu.es/">https://www.cryst.ehu.es/</a> that make this much easier, including the ability to list all symmetry operations for a given space group, even for unit cells that use non-standard lattice basis vectors, as well as the ability to determine the space group given a list of symmetry operations. The space-group diagrams at <a href="http://img.chem.ucl.ac.uk/sgp/mainmenu.htm">http://img.chem.ucl.ac.uk/sgp/mainmenu.htm</a> are also a valuable resource for visualizing and comparing space groups.</p>
<p>We can clarify further with an example, again considering the parameter file above for a thin film bcc structure. The space group for bcc in the bulk is <em>Im</em>-3<em>m</em>. We are imposing a wall that is parallel to the x-y plane, so the allowed symmetry operations for our thin film can only have (z -&gt; z) or (z -&gt; -z) transformations of the z coordinate (and the latter is only allowed for chemically identical walls). On <a href="http://img.chem.ucl.ac.uk/sgp/large/229az1.htm">this page</a> we can see the 96 symmetry operations for the <em>Im</em>-3<em>m</em> space group, and only 16 of them are allowed for the system with the wall present.</p>
<p>We then search for a space group with only these 16 symmetry operations. It will be in the tetragonal crystal system, because that is the shape of the unit cell that we expect for the thin film bcc structure. After searching through the tetragonal space groups, we find that <a href="http://img.chem.ucl.ac.uk/sgp/large/123az1.htm"><em>P</em>4/<em>mmm</em></a> is the space group we are looking for.</p>
<h2 class="doxsection"><a class="anchor" id="scft_films_relationship_sec"></a>
Relationship between unit cell and space group</h2>
<p>An important detail to note is the difference between the space group and the unit cell. The unit cell shape only defines the lattice vectors along which the system has translational symmetry. By contrast, the space group defines all of the other allowed symmetry operations in the system, some of which are only allowed for unit cells of a certain shape. For example, a cubic space group (the highest possible symmetry) represents a set of symmetry operations that can only be applied to a cubic unit cell. However, this does not mean that a cubic <em>unit cell</em> must have cubic <em>symmetry</em>&mdash;it can also have the symmetry of any of the space groups associated with crystal systems of lower symmetry (<em>e.g.</em>, tetragonal). In the context of PSCF, this means that you can choose a unit cell and a space group that belong to different crystal systems, as long as the symmetry operations of that space group are all applicable to that unit cell. For example, a tetragonal unit cell could be used with a monoclinic space group. As another example, the triclinic space group <span class="tt">P_1</span>, which has no symmetry operations other than the identity, can be used alongside all possible choices of unit cell.</p>
<p>In the thin-film bcc example discussed above, it would be fine to declare a cubic unit cell with the <em>P</em>4/<em>mmm</em> space group; this would be used to simulate a bcc structure that is slightly less than 1 unit cell thick (because of the space occupied by the walls). However, to model a film with different thickness, a tetragonal unit cell is required, which keeps the <b>a</b> and <b>b</b> lattice basis vectors the same length but allows <b>c</b> to vary. An orthorhombic unit cell, however, would be incompatible with the <em>P</em>4/<em>mmm</em> space group; <em>P</em>4/<em>mmm</em> requires that <b>a</b> and <b>b</b> are the same length.</p>
<p>This brings up a final important consideration when setting up a PSCF system: the space group contains inherent choices of which lattice parameters are allowed to vary independently and which are not, which should be considered when choosing <span class="tt">normalVecId</span>. Tetragonal unit cells must have |<b>a</b>|=|<b>b</b>|, so the natural choice of <span class="tt">normalVecId</span> is 2, so that the lattice basis vector that is perpendicular to the film (<b>c</b>) is allowed to vary independently. In fact, the space group <em>P</em>4/<em>mmm</em> is not compatible with a <span class="tt">normalVecId</span> value of 0 or 1.</p>
<p>In 3D systems, it is recommended to choose 2 for <span class="tt">normalVecId</span>, except in the case of a monoclinic unit cell, which is more compatible with a <span class="tt">normalVecId</span> value of 1. This is because &beta; is the only angle allowed to vary in a monoclinic unit cell, but a choice of 0 or 2 for <span class="tt">normalVecId</span> would force &beta; to be 90&deg; and thus force the unit cell to be stuck in an orthorhombic shape.</p>
<h2 class="doxsection"><a class="anchor" id="scft_films_initial_guess_sec"></a>
Initial guess</h2>
<p>The recommended technique for generating an initial guess is to first converge the desired morphology as a bulk calculation, and generate a converged solution in rgrid format. Then, create a new rgrid with the desired mesh size/shape by duplicating the existing data periodically along any of the lattice basis vectors. For our bcc example above, we could take a 32x32x32 bcc solution in rgrid format, duplicate the data along the <em>z</em> direction to generate a 32x32x64 mesh of bcc data, and then add 4 more layers of data points in the <em>z</em> direction (2 on top and 2 on bottom) to represent the interior of the walls, all of which should have zero concentration for all species (as an initial guess). This leaves us with a 32x32x68 initial guess in rgrid format for the bcc thin film. The gridpoint density can be increased, if desired, by interpolation. This rgrid can subsequently be converted into an initial guess for the omega field in symmetry-adapted basis format by using the RGRID_TO_BASIS and ESTIMATE_W_BASIS commands in the command file. In our experience using this tool, this approach is sufficient to achieve a converged SCFT solution for most systems of interest with minimal difficulty.</p>
<h2 class="doxsection"><a class="anchor" id="scft_films_rules_sec"></a>
Rules for determining allowed space groups and unit cells</h2>
<p>Here we present a comprehensive list of the rules determining permitted/forbidden choices of unit cell and space group in a thin film system, which have been alluded to in the above discussion.</p>
<p>Systems that are compatible with the thin film constraint must obey the following rules:</p><ul>
<li>One lattice basis vector must be normal to the walls, and all other lattice basis vectors must be parallel to the walls (discussed above).<ul>
<li>This forces all 2D oblique unit cells to assume a rectangular shape, all 3D trigonal unit cells to assume a cubic shape, and all 3D triclinic unit cells to assume a monoclinic shape, so it is pointless to use oblique, trigonal, or triclinic unit cells.</li>
<li>If normalVecId = 0 or 2 for a monoclinic unit cell, then &beta; (the only flexible angle) is forced to be 90&deg;, forcing the unit cell to assume an orthorhombic shape, so normalVecId = 1 is the recommended choice for monoclinic unit cells.</li>
<li>Setting normalVecId = 0 or 1 for a hexagonal unit cell is not allowed, since &gamma;=120&deg;.</li>
</ul>
</li>
<li>The only permitted Bravais lattice sites are on the faces/edges of the unit cell that are parallel to the walls.<ul>
<li>This prohibits all 3D space groups with a face-centered or body-centered Bravais lattice, as well as all 2D space groups with a centered rectangular Bravais net.</li>
</ul>
</li>
<li>Mirror planes and two-fold rotation axes must be either parallel or perpendicular to the walls. They may only be parallel to the walls if the two walls are chemically identical.</li>
<li>3, 4, and 6-fold rotation axes are only permitted if they are perpendicular to the walls.<ul>
<li>This prohibits all 3D space groups in the cubic crystal system, as well as all 2D space groups in the square and hexagonal crystal systems).</li>
</ul>
</li>
<li>Glide planes and two-fold screw axes are permitted if they are parallel to the walls, and only if both walls are chemically identical. All other non-symmorphic symmetry operations (glides and screws) are forbidden.</li>
<li>Inversion centers and rotoinversions are only permitted if the walls are chemically identical.</li>
<li>The only allowed space groups in the trigonal crystal system are those with a hexagonal Bravais lattice (space groups starting with "P"). Trigonal space groups with a rhombohedral Bravais lattice (starting with "R") do not have any lattice vector that is normal to the other two. Although one can represent a rhombohedral Bravais lattice in a non-primitive hexagonal unit cell, this results in two Bravais lattice sites in the middle of the unit cell, which is not allowed. As such, neither representation of such a unit cell is compatible with thin film constraints. The distinction between crystal system, Bravais lattice, and unit cell can be confusing for the trigonal crystal system, so the reader is directed to the very helpful summary at <a href="https://en.wikipedia.org/wiki/Hexagonal_crystal_family">https://en.wikipedia.org/wiki/Hexagonal_crystal_family</a> for more details.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="scft_films_dynamic_sec"></a>
Dynamic mask method</h1>
<p>As mentioned briefly above, PSCF has a feature that allows the film thickness to be optimized within a single SCFT calculation, using the so-called "dynamic mask method". The method is described in detail in a forthcoming manuscript by B. R. Magruder and K. D. Dorfman (2025). Here we summarize only the key details needed to use the feature in PSCF, and readers are directed to the manuscript for more information on the theory.</p>
<p>The "stress" defined in PSCF is simply the derivative of the Helmholtz free energy per monomer reference volume \( f \) with respect to a lattice parameter \( \theta \). We typically define masks and external fields as functions of the lattice parameters, and these imposed fields will distort non-affinely upon changes to the lattice parameters. The stress in such cases requires the computation of added contributions from the non-affine distortions of the imposed fields. The "dynamic mask method" provides an expression for these additional terms, which are calculated in PSCF.</p>
<p>To optimize the film thickess using a stress, we must define what it means for the thickness to be "optimized". It is understood in the literature (see references above) that a thin film is at its commensurate film thickness when the excess free energy per unit area of film is minimized. The excess free energy is defined relative to the free energy of the corresponding bulk phase. For example, in a thin film with a lamellar morphology, the reference free energy would be that of a lamellar phase of that same polymer system in the bulk. Let \( f_{\rm bulk} \) denote this reference free energy (per monomer reference volume), and let  \( f_{\rm
ex}=f-f_{\rm bulk} \) denote the excess free energy per monomer reference volume. To convert this into an excess free energy per unit area, we need only multiply by the film thickness \( \Delta \). The property we wish to minimize in the SCFT calculation, then, is \( f_{\rm ex} \Delta \).</p>
<p>We therefore redefine the stress in the direction normal to the film, so that the value used to optimize the unit cell is the derivative of  \(f_{\rm ex} \Delta \) with respect to the lattice parameter  \( \theta_j
\). Using the dynamic mask method, this stress can be calculated, and the optimized unit cell size is found by minimizing this stress.</p>
<p>To actually perform such a calculation in PSCF, one simply needs to include the reference free energy \( f_{\rm bulk} \) as an additional parameter in the parameter file. The parameter is named <span class="tt">fBulk</span> and comes immediately after <span class="tt">interfaceThickness</span>, as exemplified by the parameter file block below: </p><div class="fragment"><div class="line">FilmEnvironment{</div>
<div class="line">   normalVecId         2</div>
<div class="line">   interfaceThickness  0.2</div>
<div class="line">   excludedThickness   0.4</div>
<div class="line">   fBulk               2.98353412</div>
<div class="line">   chiBottom[</div>
<div class="line">                       0</div>
<div class="line">                       10</div>
<div class="line">   ]</div>
<div class="line">   chiTop[</div>
<div class="line">                       0</div>
<div class="line">                       10</div>
<div class="line">   ]</div>
<div class="line">}</div>
</div><!-- fragment --><p> If <span class="tt">fBulk</span> is provided, PSCF will allow the film thickness to be flexible during iteration, using the dynamic mask method to calculate the stress, unless the user specifies in the Iterator block that the parameter should be rigid. The value to use for <span class="tt">fBulk</span> should be computed using a separate PSCF calculation for the corresponding bulk phase.</p>
<p><br  />
 <a class="el" href="scft_environment_page.html">Environments &ndash; Confinement and External Fields</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="scft_visualize_page.html">Visualization</a> (Next) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on <span class="timestamp"></span> for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
