<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: Directory Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">PSCF - Polymer Self-Consistent Field Theory</a></li><li class="navelem"><a class="el" href="developer_page.html">Developer Information</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Directory Structure</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="developer_list_page.html">Source File Lists</a> (Next) <br  />
</p>
<p>This page provides an introduction to the directory structure of the PSCF repository aimed at developers, as well as very brief introduction to the build system. The PSCF build system is discussed in greater detail in following pages.</p>
<h1><a class="anchor" id="developer_directory_summary_sec"></a>
PSCF root directory</h1>
<p>A user's local copy of the PSCF repository is normally created by <a class="el" href="install_source_page.html#source_getcode_sec">cloning project dmorse/pscfpp</a> from github.com, while using the &ndash;recursive option to load the contents of two other github repositories into subdirectories as <a class="el" href="install_source_page.html#source_submodules_sec">git submodules</a>. By default, this creates a directory named pscfpp as a subdirectory of the directory from which the git clone command was issued. In what follows, we refer to the resulting directory, which contains the contents of the entire PSCF repository and its submodules, as the PSCF root directory.</p>
<p>The PSCF root directory can be renamed or moved by the user after it is created. If a user does so, however, they must then run or rerun the <a class="el" href="install_configure_page.html">configure</a> script in order to allow this script to assign new values for some makefile variables that contains absolute paths to the PSCF root directory and some of its subdirectories, as discussed <a class="el" href="#developer_directory_dirvars_sec">below</a>.</p>
<p>The names and purposes of all of the top-level subdirectories of the PSCF root directory are given briefly below:</p>
<table class="doxtable">
<tr>
<th>Directory  </th><th>Purpose   </th></tr>
<tr>
<td>src  </td><td>Contains all C++ and CUDA C++ source code   </td></tr>
<tr>
<td>bld  </td><td>Build directory for out-of-source builds   </td></tr>
<tr>
<td>bin  </td><td>Default installation location for executable files   </td></tr>
<tr>
<td>lib  </td><td>Source code for interpreted languages (python and bash)   </td></tr>
<tr>
<td>docs  </td><td>Documentation, including source pages for web manual   </td></tr>
<tr>
<td>examples  </td><td>Examples input files for various types of calculation   </td></tr>
<tr>
<td>data  </td><td>Read-only data, such as lists of space group symmetry elements   </td></tr>
<tr>
<td>make  </td><td>Files copied to otherwise used by the "configure" script   </td></tr>
</table>
<p>The three most important top-level subdirectories are the first three listed above: src, bld and bin.</p>
<p>In what follows, we describe file name patterns and standard file extension using the * (asterisk) symbol to represent a wildcard that can represent any string of characters. For example, the pattern *.h can represent any file name that ends in extension .h, which is a standard file name extension for C++ header files. We sometimes refer to file names that match such a pattern either as, for example, *.h files.</p>
<h1><a class="anchor" id="developer_directory_blddir_sec"></a>
Overview of build process</h1>
<p>PSCF is compiled by the user using a system of unix makefiles. Compilation and installation of the package involves the following steps:</p>
<ul>
<li>Compiling all source files in the src directory</li>
<li>Creating several static library files</li>
<li>Creating executable files (pscf_1d, pscf_pc, and pscf_pg)</li>
</ul>
<p>Several aspects of this process are described in more detail below.</p>
<p>All C++ and C++/CUDA source files for PSCF are located in the src directory tree. When a source file in this directory is compiled, the build system creates two associated files that we refer to as an object file and a dependency file. <br  />
</p>
<ul>
<li>An object file is a file with file name extension .o that contains the object code created by compiling the associated source file. <br  />
</li>
<li>A dependency file is a makefile fragment with file name extension .d that contains a makefile rule that lists all the the pre-requisites of the associated source file.</li>
</ul>
<p>The object and dependency file that are created by compiling a source file have the same base file name as the associated source file.</p>
<p>The PSCF build system also creates several static libraries with file names of the form lib*.a. Each such library contains all of the assembly code created by compiling the source files in one top-level subdirectory of the src directory.</p>
<p>The object, dependency and library files that are created during the build process are referred to in what follows as "intermediate" files. The directory in which all such intermediate files are placed is referred to as the build directory.</p>
<p>The PSCF makefile system is designed to allow a user to perform either an "out-of-source" build or an "in-source" build. In an "out-of-source" build, all intermediate files created during compilation are placed in a build directory that is distinct from the src directory. By default, PSCF uses the bld subdirectory of the PSCF root directory as the build directory for this purpose. In an "in-source" build, these intermediate files are instead placed within the src directory, alongside the source files from which they were created.</p>
<p>During an in-source build, the PSCF build system places the *.o object file and the *.d dependency file that are created by compiling one source file in the same subdirectory of src as the associated source file. During an out-of-source build, these two files are instead placed in an analogous subdirectory of the bld directory tree. To make this convention possible, the bld directory must have an internal directory structure exactly analogous to that of the src directory.</p>
<p>PSCF is built by invoking the "make" command. The choice between in-source and out-of-source compilation is determined by the working directory from which a user invokes "make": Invoking "make" from either the PSCF root directory or from the bld directory causes make to perform an out-of-source build in which intermediate files are placed in the the bld directory. Invoking "make" from the src directory instead causes make to be built in-source.</p>
<h1><a class="anchor" id="developer_directory_src_sec"></a>
Source file (src) directory</h1>
<p>The src directory contains all of the C++ and C++/CUDA source code files for PSCF. The structure of subdirectories of src reflects the organization of entities defined in the source code (i.e., classes and functions) into several C++ namespaces.</p>
<p><b>C++ namespaces:</b></p>
<p>The source code for PSCF is divided between two top-level C++ namespaces, named <a class="el" href="namespaceUtil.html" title="Utility classes for scientific computation.">Util</a> and <a class="el" href="namespacePscf.html" title="PSCF package top-level namespace.">Pscf</a>.</p>
<p>The <a class="el" href="namespaceUtil.html" title="Utility classes for scientific computation.">Util</a> namespace contains a collection of general utilities for scientific computation that are also used by projects other than PSCF. The code is maintained in a separate github repository (project dmorse/util) and imported into the pscfpp repository as a git submodule. All source code files for entities that are defined in the <a class="el" href="namespaceUtil.html" title="Utility classes for scientific computation.">Util</a> namespace are located in the src/util directory.</p>
<p>The <a class="el" href="namespacePscf.html" title="PSCF package top-level namespace.">Pscf</a> namespace contains all of source code files that are contained in the dmorse/pscfpp github repository, all of which are specific to the PSCF package. The <a class="el" href="namespacePscf.html" title="PSCF package top-level namespace.">Pscf</a> namespace contains several enclosed sub-namespaces. All source code for each such enclosed namespace is located within a specific subdirectory of the src directory, as discussed below.</p>
<p><b>Namespace-level directories:</b></p>
<p>The src directory contains six subdirectories that each contain code defined in a specific C++ namespace. These six directories will be referred to in what follows as "namespace" level subdirectories of src. These six namespace-level subdirectories are listed below:</p>
<table class="doxtable">
<tr>
<th>Subdirectory </th><th>Namespace </th><th>Purpose  </th></tr>
<tr>
<td>util  </td><td><a class="el" href="namespaceUtil.html" title="Utility classes for scientific computation.">Util</a>  </td><td>General utilities   </td></tr>
<tr>
<td>pscf  </td><td><a class="el" href="namespacePscf.html" title="PSCF package top-level namespace.">Pscf</a>  </td><td>Code defined directly in <a class="el" href="namespacePscf.html" title="PSCF package top-level namespace.">Pscf</a>, used by all PSCF programs   </td></tr>
<tr>
<td>prdc  </td><td><a class="el" href="namespacePscf_1_1Prdc.html" title="Periodic fields and crystallography.">Pscf::Prdc</a>  </td><td>Code for periodic structures, used by pscf_pc and pscf_pg programs   </td></tr>
<tr>
<td>r1d  </td><td><a class="el" href="namespacePscf_1_1R1d.html" title="SCFT with real 1D fields.">Pscf::R1d</a>  </td><td>Code used only by the pscf_1d program   </td></tr>
<tr>
<td>rpc  </td><td><a class="el" href="namespacePscf_1_1Rpc.html" title="Real periodic fields, SCFT and PS-FTS (CPU).">Pscf::Rpc</a>  </td><td>Code used only by the pscf_pc CPU program for periodic structures   </td></tr>
<tr>
<td>rpg  </td><td><a class="el" href="namespacePscf_1_1Rpg.html" title="SCFT and PS-FTS with real periodic fields (GPU)">Pscf::Rpg</a>  </td><td>Code used only by the pscf_pg GPU program for periodic structures   </td></tr>
</table>
<p>The src/pscf directory contains files that contain code for class and functions that are defined directly in the <a class="el" href="namespacePscf.html" title="PSCF package top-level namespace.">Pscf</a> namespace, rather than in one of the enclosed sub namespaces of <a class="el" href="namespacePscf.html" title="PSCF package top-level namespace.">Pscf</a>. The src/prdc, src/r1d, src/rpc, and src/rpg instead each contain code for entities that are defined in a specific sub-namespace of <a class="el" href="namespacePscf.html" title="PSCF package top-level namespace.">Pscf</a>.</p>
<p>The PSCF makefile system constructs a static library in each of these six namespace level directories. Each static library file is a file with a name of the form lib[namespace].a, where [namespace] represents the name of the relevant subdirectory. For example, the build system creates a library file named libprdc.a in the src/prdc directory.</p>
<p>The r1d, rpc and rpg subdirectories of src each contain code is only used in a one executable program. Specifically r1d contains code that is only used by pscf_1d, rpc contains all code that only used by pscf_pc, and rpg contains code that only used by pscf_pg. Each of these three directories also contains a main program file that defines the main function for the associated program. The directories util, pscf and prdc do not contain any main program files, and instead contain code for classes and functions that can be used in more than program.</p>
<p><b>Dependencies among namespace level directories:</b></p>
<p>PSCF imposes a set of rules for dependencies among the various namespace level directories. A namespace level directory named A is said to <em>depend</em> on another such directory named B if C++ files in directory A are allowed to use entities (i.e., classes, class templates or functions) that are defined by files in directory B. The following table lists the directories that each of the namespace level directories depend upon in this sense: </p><table class="doxtable">
<tr>
<th>Subdirectory </th><th>Dependencies   </th></tr>
<tr>
<td>util  </td><td>(None)   </td></tr>
<tr>
<td>pscf  </td><td>util   </td></tr>
<tr>
<td>prdc  </td><td>pscf, util   </td></tr>
<tr>
<td>r1d  </td><td>pscf, util   </td></tr>
<tr>
<td>rpc  </td><td>prdc, pscf, util   </td></tr>
<tr>
<td>rpg  </td><td>prdc, pscf, util   </td></tr>
</table>
<p>Every directory other than util depends on util, and every directory other than util and pscf depends on util and pscf. These two directories thus provide code that used through PSCF code. The prdc directory contains code that is only needed in the pscf_pc and pscf_pg programs for systems with periodic boundary conditions, and so is listed as a dependency of associated directories rpc and rpg.</p>
<p><b>Unit test directories:</b></p>
<p>In addition to these namespace level subdirectories, the src directory has one additional top-level subdirectory named "test" that contains files that define a C++ unit test framework. This framework is defined using only header (*.h) files, and thus does not need to be compiled or linked. The unit test framework used by PSCF is maintained on github in a separate repository (dmorse/test) and is imported into the src/test directory of a user's PSCF repository as a submodule.</p>
<p>Each of the six namespace level subdirectories of the src directory also contains a subdirectory named "tests" that contains unit tests for classes and functions defined in the associated namespace. These unit tests are not automatically compiled or run by the commands that build the PSCF executable programs.</p>
<p>All of the PSCF unit tests can be run by changing directory to the desired build directory (src or bld/) and entering the command </p><div class="fragment"><div class="line">make test</div>
</div><!-- fragment --><p> All of the tests associated with a single namespace level directory can be compiled and run by changing directory to the corresponding tests subdirectory within that namespace directory in the relevant build directory (i.e., within a namespace level subdirectory of the bld directory for an out-of source build, or within a namespace level subdirectory of src for an in-source-build) and entering </p><div class="fragment"><div class="line">make run</div>
</div><!-- fragment --><p> from within that subdirectory.</p>
<p><b>Source code file types:</b></p>
<p>All C++ files associated with a given class or set of functions are placed in the same directory and have the same base name. The name of a file that contains C++ code for a specific class or class template has a base name that is same as the class name, and has a file name extension that indicates the file type. All class names are upper space camel (such as <a class="el" href="classPscf_1_1Monomer.html" title="Descriptor for a monomer type.">Pscf::Monomer</a>).</p>
<p>PSCF uses the following file name patterns and file extensions for C++ and CUDA C++ files:</p>
<table class="doxtable">
<tr>
<th>Pattern  </th><th>Purpose   </th></tr>
<tr>
<td>*.h  </td><td>C++ header file   </td></tr>
<tr>
<td>*.tpp  </td><td>implementation of a class template   </td></tr>
<tr>
<td>*.cpp  </td><td>compilable C++ source file   </td></tr>
<tr>
<td>*.cu  </td><td>compilable CUDA C++ source file   </td></tr>
</table>
<p>Header files, with extension .h, may be included into other C++ files using a C/C++ #include directive. C++ and CUDA C++ source files, with extension .cpp or .cu, are compiled, and may never be included by other program files. Template implementation files, with extension .tpp, are generally included into either an associated *.h header file or an associated *.cpp or *.cu source file with the same base name (as discussed in more detail developer_template_page "here"), and may not be directly included by other files.</p>
<p>Compilable source files that contain or include only standard C++ code should be given file extension .cpp. Compilable source files that contain or include any CUDA C++ code must instead use file extension .cu. Different makefile pattern rules are used to compile files with filename extension .cpp and .cu, using different compilers, using the NVIDIA nvcc compiler to compile files with file extension .cu.</p>
<p><b>Build system and documentation files types:</b></p>
<p>The following table explains the purposes of several other types of file that are the user will see in the src directory after running the configure script. </p><table class="doxtable">
<tr>
<th>Pattern  </th><th>Purpose   </th></tr>
<tr>
<td>makefile  </td><td>makefile (instructions for the make command)  </td></tr>
<tr>
<td>*.mk  </td><td>makefile fragment (included by other makefiles)  </td></tr>
<tr>
<td>*.dox  </td><td>doxygen documentation file (manual page)   </td></tr>
<tr>
<td>*.mod  </td><td>doxygen documentation file (topic module)   </td></tr>
</table>
<p>After the configure script is run, the bld directory will also contain several files named "makefile", but not either of the types of documentation files listed above.</p>
<h1><a class="anchor" id="developer_directory_configmk_sec"></a>
Configuration (config.mk) files</h1>
<p>After the configure script is run, the src and bld directory will each contain a makefile fragment named config.mk. Each of this is the main configuration file used by the build system to build in the directory that contains the configuration file. This file assigns values to a variety of makefile variables that are needed throughout the build system.</p>
<p>The config.mk configuration file in each build directory (i.e., in the src or bld directory) is included in every other makefile in the same build directory tree. The config.mk file in the src directory is thus included by all makefiles in the src directory tree, but not those in the bld directory, and so only affects in-source builds that are performed by calling make from within the src directory. Conversely, the config.mk file in the bld directory is included by all makefiles in the bld directory tree, but not those in the src directory, and so only affects out-of-source builds.</p>
<h1><a class="anchor" id="developer_directory_dirvars_sec"></a>
Directory path variables</h1>
<p>Among the variables defined in the config.mk file in each build directory are makefile variables whose values give paths to the PSCF root directory and several of its subdirectories. The names and meanings of the most important such path variables are listed below: </p><table class="doxtable">
<tr>
<th>Name  </th><th>Meaning   </th></tr>
<tr>
<td>ROOT_DIR  </td><td>Path to PSCF root directory   </td></tr>
<tr>
<td>SRC_DIR  </td><td>Path to the source directory   </td></tr>
<tr>
<td>BLD_DIR  </td><td>Path to the build directory   </td></tr>
<tr>
<td>BIN_DIR  </td><td>Path to directory for installing executables   </td></tr>
</table>
<p>The values assigned to all of these variables are absolute paths. On any unix-like system, the first character of an absolute path is a backslash ("/") character that represents the root of the computer filesystem. The value of the ROOT_DIR variable is set by the configure script to be the absolute path to the root directory as identified by this script at the time that the configure script was run. Values of other variables are defined using the value of ROOT_DIR, as discussed below.</p>
<p>As an example, suppose that a user with user name smith has a home directory /users/smith, and suppose that this user has installed the PSCF root directory as a subdirectory of their home directory, as /users/smith/pscfpp. In this case, the part of the config.mk file that is located in the users bld directory that defines these path variables would look like this after the configure script has been run: </p><div class="fragment"><div class="line">ROOT_DIR=/users/smith/<a class="code hl_namespace" href="namespacepscfpp.html">pscfpp</a></div>
<div class="line">SRC_DIR=$(ROOT_DIR)/src</div>
<div class="line">BLD_DIR=$(ROOT_DIR)/bld</div>
<div class="line">BIN_DIR=$(ROOT_DIR)/bin</div>
<div class="ttc" id="anamespacepscfpp_html"><div class="ttname"><a href="namespacepscfpp.html">pscfpp</a></div><div class="ttdoc">Python package of all python modules provided with PSCF.</div><div class="ttdef"><b>Definition</b> <a href="____init_____8py_source.html#l00001">__init__.py:1</a></div></div>
</div><!-- fragment --><p> The symbol  represents the value of the makefile variable ROOT_DIR, which is given here by the string /usrs/smith/pscfpp. The config.mk file in the bld directory is only included by makefiles in the bld directory, and is only used during an out-of-source build that is performed by invoking make from within the PSCF root directory or the bld directory. This configuration file thus declares /bld to be the build directory in which all intermediate files should be placed.</p>
<p>The corresponding variable definitions in the config.mk file in the src directory in this example would be almost identical to those shown above, <em>except</em> for the value assigned to the variable BLD_DIR: In the file src/config.mk, BLD_DIR would be assigned a value /src rather than /bld. In both cases, the value of BLD_DIR is an absolute path to the directory that contains the config.mk file This configuration file thus declares the build directory BLD_DIR used during in-source-bld is the same as the src directory.</p>
<p>If the name or location of the PSCF root directory is changed after the configure script has been run, users will need to rerun the configure script to reset the value of the makefile variable ROOT_DIR to the correct location.</p>
<p>Users can, if desired, change the location in which executable files are installed by using an text editor to change the value assigned to BIN_DIR within either or both of these configuration files. The executable files produced by PSCF are self-contained and may be moved after they are created. Users may thus also simply move the executable files to a new location after building PSCF.</p>
<p>If the name or location of the PSCF root directory is changed after after executables have been created, however, users will need to rerun the configure script and then rebuild PSCF to create new executables. <br  />
 This is necessary because some of the PSCF executables contain a path to the PSCF data directory that is used to access read-only data files at run time. Currently, the only files that are accessed in this way are files in the directory data/groups that specify the symmetry elements for all standard crystallographic space groups. The files are accessed by the pscf_pc and pscf_pg programs. In order for these programs to function correctly, the path to the data directory cannot change after these executables are created.</p>
<p><br  />
 <a class="el" href="developer_page.html">Developer Information</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="developer_list_page.html">Source File Lists</a> (Next) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 14 2025 16:29:26 for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
