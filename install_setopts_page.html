<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSCF: Compile Time Options</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PSCF<span id="projectnumber">&#160;v1.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">PSCF - Polymer Self-Consistent Field Theory</a></li><li class="navelem"><a class="el" href="install_page.html">Installation</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Compile Time Options</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="install_inout_page.html">Out-of-Source and In-Source Builds</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="install_targets_page.html">Makefile targets</a> (Next) <br  />
</p>
<p>The PSCF build system provides a set of scripts named "setopts" that allow the users to set some optional compile-time features of the package to be enabled or disabled when it is compiled, and to set some parameters that are passed to the compiler.</p>
<h1><a class="anchor" id="install_setopts_setopts"></a>
The "setopts" scripts</h1>
<p>The PSCF src/ and bld/ directories are used as build directories for in-source and out-of source compilation, respectively. After the configure script has been run, each of these two standard build directories will contain an exectuable shell script named "setopts". A setopts script can be used to modify configuration files that control what features are enabled when code is compiled. <br  />
</p>
<p>The setopts script in each build directory may be invoked from within that directory (i.e., from the src/ or bld/ directory) in order to modify which features will be enabled and disabled in code that is subsequently compiled in that build directory.</p>
<p>The PSCF root directory (usually named pscfpp/) also contains an analogous setopts script. That "global" setopts script can be invoked to apply identical changes in compile-time features to the configuration files in both the src/ and bld/ directories.</p>
<p>The setopts scripts function by editing configuration files that are used by the makefile system to define what actions should be taken during compilation. These configuration files, all of which are named config.mk, are installed by the configure script. A setopts script must thus be invoked after running the configure script, but before compiling.</p>
<h2><a class="anchor" id="install_setopts_debug_sub"></a>
Enabling or disabling debugging</h2>
<p>The "debugging" feature of PSCF can be enabled to add additional run-time sanity checks (such as run-time checking of array index bounds) at a slight cost in performance. The "debugging" feature is enabled or disabled by invoking setopts script before compiling the package with the "-d" option, using an option parameter "1" to enable debugging or "0" to disable it. The debugging feature is disabled by default. To enable debugging checks in the code built in either the src/ or bld/ directory one would enter </p><div class="fragment"><div class="line">./setopts -d1</div>
</div><!-- fragment --><p> from the PSCF root directory. To instead disable debugging before compiling, one would enter </p><div class="fragment"><div class="line">./setopts -d0</div>
</div><!-- fragment --><p> The same commands can also be invoked from bld/ or src/ directory to enable or disable debugging only in a single build directory.</p>
<h2><a class="anchor" id="install_setopts_cuda_sub"></a>
Enabling or disabling CUDA compilation</h2>
<p>The CUDA feature enables conditional compilation of CUDA code on machines that have an appropriate nVidia GPU and CUDA development kit. Compilation of CUDA code is disabled by default. Compilation of CUDA code can be enabled or disabled by invoking a setopts script with the "-c" option, with an option parameter "1" to enable CUDA compilation or "0" to disable CUDA compilation.</p>
<p>To enable compilation of CUDA source files in any code compiled in either the bld/ or src/ directory, one would enter </p><div class="fragment"><div class="line">./setopts -c1</div>
</div><!-- fragment --><p> from the PSCF root directory. To disable CUDA compilation, one would instead enter </p><div class="fragment"><div class="line">./setopts -c0</div>
</div><!-- fragment --><p> The same commands can be invoked from a specific build directory (i.e., from within the source or src/ or bld/ directory) to enable or disable compilation of CUDA code only in that build directory (i.e,. only in code that is compiled out-of-source or in-source). <br  />
</p>
<h2><a class="anchor" id="install_setopts_arch_sub"></a>
Setting a target GPU architecture</h2>
<p>Before attempting to compile CUDA code, one should use a setopts script to set the compiler to generate code optimized for the specific type of NVIDIA GPU that is installed on the computer on which the program will be run. This is done by issuing a command of the form </p><div class="fragment"><div class="line">./setopts -a [architecture id]</div>
</div><!-- fragment --><p> in which [architecture id] represents a string identifier for a particular GPU architecture. <br  />
</p>
<p>The architecture id that is passed to the -a option is a string of the form "sm_MN" in which M and N represent the major (M) and minor (N) version numbers for the CUDA "compute capability" of the relevant GPU. This command sets the value of the makefile variable NVARCH, which is defined in the file src/config.mk or bld/config.mk. The value of this variable is passed to the NVIDIA nvcc CUDA compiler as the parameter of the "-arch" compiler option. By default, NVARCH is set to "sm_35", corresponding to compute capability 3.5, which is the appropriate level for a K40 GPU.</p>
<h2><a class="anchor" id="install_setopts_query_sub"></a>
The "query" (-q) option</h2>
<p>The -q command line option of the setopts script may be used to query what optional features are currently set to be enabled or disabled during compilation. To see an example, change directory (cd) to the PSCF bld/ directory and then enter </p><div class="fragment"><div class="line">./setopts -q</div>
</div><!-- fragment --><p> This should result, for example, in the output </p><div class="fragment"><div class="line">-d  OFF - debugging</div>
<div class="line">-c  OFF - CUDA compilation</div>
</div><!-- fragment --><p> if debugging and CUDA compilation are both disabled (the default configuration), or </p><div class="fragment"><div class="line">-d  OFF - debugging</div>
<div class="line">-c  ON  - CUDA compilation</div>
</div><!-- fragment --><p> if debugging is disabled but CUDA compilation has been enabled.</p>
<p>Entering "./setopts -q" from the PSCF root directory instead yields a report that shows which optional features are enabled in both the bld/ and src/ directory.</p>
<h2><a class="anchor" id="install_setopts_help_sub"></a>
The "help" (-h) option</h2>
<p>Invoking the setopts script with the -h ("help") option, by entering </p><div class="fragment"><div class="line">./setopts -h</div>
</div><!-- fragment --><p> produces a list of all command line options accepted by the script.</p>
<h1><a class="anchor" id="install_setopts_build_directories_section"></a>
Build configuration files</h1>
<p>The configuration of the build system is actually defined by the contents of a set of files named "config.mk" in the src/ and bld/ directories. These files, which we refer to as build configuration files, are makefile fragments that are included by other makefiles during the build process. The setopts scripts work by editing the build configuration files. <br  />
 Users may also edit these files directly if they are comfortable doing so. The configuration files contain comments that explain the meaning and usage of all of the variables defined there.</p>
<p>The directories src/ and bld/ contain analogous directory structures, and similar sets of build configuration files. In what follows, we will refer to src/ and bld/ generically as build directories. Both of these directories contains a set of five subdirectories named util/, pscf/, r1d/, pscpc/, and rpg/ that each contain C++ source files from a single C++ namespace. We refer to these top-level subdirectories of bld/ and src/ as "namespace-level" subdirectories.</p>
<p>After the configure script has been run, each build directory will contain 6 build configuration files files named "config.mk", with one in the root of the build directory (i.e., in src/ and bld/) and one in each of the 5 namespace-level subdirectories of that directory. The config.mk file in the root directory of each build directory tree is the main build configuration file for code built in that directory. This file controls the choice of compiler and general options that are applied to all code built there. The config.mk files in the namespace level directories each specify more specialized options that are only relevant for code in specific subdirectories or C++ namespaces.</p>
<p><br  />
 <a class="el" href="install_inout_page.html">Out-of-Source and In-Source Builds</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="install_page.html">Installation</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="install_targets_page.html">Makefile targets</a> (Next) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 14 2025 16:24:04 for PSCF by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
